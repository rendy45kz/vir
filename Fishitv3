--========================================================--
-- ğŸ£ FISH IT - by @diketjup (Refined by bubb)
--========================================================--

-- anti double execute
if getgenv().FISHIT_LOADED then return end
getgenv().FISHIT_LOADED = true

if not game:IsLoaded() then game.Loaded:Wait() end

-- =========================
-- // Services & Globals
-- =========================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local player = LocalPlayer

-- =========================
-- // Rayfield UI Loader
-- =========================
local Rayfield
do
	local ok, lib = pcall(function()
		return loadstring(game:HttpGet("https://sirius.menu/rayfield", true))()
	end)
	if not ok or not lib then
		warn("Gagal memuat Rayfield UI.")
		return
	end
	Rayfield = lib
end

local Window = Rayfield:CreateWindow({
	Name = "ğŸ£ FISH IT - by @diketjup BETA TEST!",
	LoadingTitle = "Ready...",
	LoadingSubtitle = "don't expect more",
	ConfigurationSaving = { Enabled = false }
})

-- =========================
-- // Config
-- =========================
local Config = {
	AutoFishing = false,
	Delay = 1,
	AutoRespawn = false,
	RespawnInterval = 60 * 60, -- default 1 jam
}

-- =========================
-- // Remotes (helper rebind)
-- =========================
local function GetNetRemote(name)
	local ok, net = pcall(function()
		return ReplicatedStorage:WaitForChild("Packages")
			:WaitForChild("_Index")
			:WaitForChild("sleitnick_net@0.2.0")
			:WaitForChild("net")
	end)
	if not ok or not net then return nil end
	return net:FindFirstChild(name)
end

local EquipTool = GetNetRemote("RE/EquipToolFromHotbar")
local EquipTool = GetNetRemote("RE/UnequipToolFromHotbar")
local ChargeRod = GetNetRemote("RF/ChargeFishingRod")
local StartMini = GetNetRemote("RF/RequestFishingMinigameStarted")
local FinishFish = GetNetRemote("RE/FishingCompleted")

local function RebindRemotes()
	pcall(function()
		EquipTool = GetNetRemote("RE/EquipToolFromHotbar") or EquipTool
		EquipTool = GetNetRemote("RE/UnequipToolFromHotbar") or UnquipTool
		ChargeRod = GetNetRemote("RF/ChargeFishingRod") or ChargeRod
		StartMini = GetNetRemote("RF/RequestFishingMinigameStarted") or StartMini
		FinishFish = GetNetRemote("RE/FishingCompleted") or FinishFish
	end)
	print("[AutoFish] Remotes rebound:", EquipTool and "Equip OK" or "Equip NIL",
		ChargeRod and "Charge OK" or "Charge NIL",
		StartMini and "StartMini OK" or "StartMini NIL",
		FinishFish and "Finish OK" or "Finish NIL")
end

-- initial bind attempt
RebindRemotes()

-- Rebind & siapin ulang ketika CharacterAdded (dipakai sesudah respawn)
player.CharacterAdded:Connect(function(char)
    task.defer(function()
        RebindRemotes()
        -- kasih sedikit waktu model spawn
        task.wait(0.8)
        local ok, _ = pcall(function()
            if EquipTool then EquipTool:FireServer(1) end -- pegang rod lagi
        end)
    end)
end)


-- =========================
-- // Utility helpers
-- =========================
local function GetNow()
	if workspace and workspace.GetServerTimeNow then
		local ok, res = pcall(function() return workspace:GetServerTimeNow() end)
		if ok and res then return res end
	end
	return tick()
end

local function Notify(title, content, dur)
	if Rayfield and Rayfield.Notify then
		Rayfield:Notify({Title = title, Content = content, Duration = dur or 3})
	end
end

-- -- =========================
-- -- // Auto-disable on respawn + rebind
-- -- =========================
-- player.CharacterAdded:Connect(function()
-- 	-- disable autofish for safety on respawn
-- 	if Config.AutoFishing then
-- 		Config.AutoFishing = false
-- 		-- update toggle UI later via callback reference if needed
-- 		Notify("ğŸ’€ Respawn", "AutoFishing dimatikan. Nyalakan lagi setelah siap.", 3)
-- 		print("[AutoFish] CharacterAdded -> AutoFishing OFF (safety)")
-- 	end
-- 	-- slight delay then rebind remotes
-- 	task.delay(1.5, RebindRemotes)
-- end)

-- =========================
-- // TestStartMini (debug)
-- =========================
local function TestStartMini(x,y)
	x = x or -0.75; y = y or 0.99
	if not StartMini then
		Notify("TestStartMini", "StartMini remote NIL", 4)
		return false, "StartMini NIL"
	end
	local ok, res = pcall(function()
		-- try InvokeServer if available, else FireServer fallback
		if type(StartMini.InvokeServer) == "function" then
			return StartMini:InvokeServer(x,y)
		else
			StartMini:FireServer(x,y)
			return "fired"
		end
	end)
	Notify("TestStartMini", "ok=" .. tostring(ok) .. " | res=" .. tostring(res), 4)
	print("[TestStartMini] ok:", ok, "res:", res)
	return ok, res
end

-- =========================
-- // Robust AutoFishing Loop (emulator-safe)
-- =========================
local function AutoFishingLoop_Robust()
	task.spawn(function()
		print("[AutoFish] Loop started")
		while Config.AutoFishing do
			local okCycle = pcall(function()
				-- ensure remotes
				if not (EquipTool and ChargeRod and StartMini and FinishFish) then
					Notify("âš ï¸ Remote Missing", "Mencoba rebind remotes...", 3)
					RebindRemotes()
					task.wait(2)
					return
				end

				-- ensure character HRP valid
				local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
				local hrp = char and char:FindFirstChild("HumanoidRootPart")
				if not hrp then
					warn("[AutoFish] HRP not found")
					task.wait(1)
					return
				end

				-- Equip rod
				pcall(function() EquipTool:FireServer(1) end)
				task.wait(0.15)

				-- Charge (Invoke preferred, fallback Fire)
				local now = GetNow()
				local okCharge, chargeRes = pcall(function() 
					if type(ChargeRod.InvokeServer) == "function" then
						return ChargeRod:InvokeServer(now)
					else
						ChargeRod:FireServer(now)
						return "fired"
					end
				end)
				if not okCharge then
					warn("[AutoFish] ChargeRod failed:", tostring(chargeRes))
				end
				task.wait(0.15)

				-- prepare XY (randomized)
				local baseX, baseY = -0.75, 0.99
				local x = baseX + math.random(-500,500)/10000000
				local y = baseY + math.random(-500,500)/10000000

				-- Try StartMini via Invoke, fallback to Fire
				local okStart, startRes = pcall(function()
					if type(StartMini.InvokeServer) == "function" then
						return StartMini:InvokeServer(x,y)
					else
						StartMini:FireServer(x,y)
						return "fired"
					end
				end)

				if not okStart then
					-- fallback FireServer attempt if Invoke failed
					warn("[AutoFish] StartMini.Invoke failed:", tostring(startRes))
					local okFire, fireRes = pcall(function() 
						if type(StartMini.FireServer) == "function" then
							StartMini:FireServer(x,y)
							return true
						end
						return false
					end)
					print("[AutoFish] StartMini Fire fallback ok:", okFire, "res:", fireRes)
				else
					print("[AutoFish] StartMini ok:", tostring(startRes))
				end

				-- WAIT for server to process (configurable)
				task.wait((Config.Delay or 0.3) + 0.15)

				-- FinishFish (FireServer)
				local okFinish, finishRes = pcall(function()
					return FinishFish:FireServer()
				end)
				if okFinish then
					print("[AutoFish] FinishFish fired OK")
				else
					warn("[AutoFish] FinishFish failed:", tostring(finishRes))
				end

				-- short cooldown
				task.wait(0.1)
			end)

			if not okCycle then
				warn("[AutoFish] Cycle pcall failed, continuing next cycle")
				task.wait(1)
			end
		end
		print("[AutoFish] Loop ended")
	end)
end


-- === AutoFish helpers (start/stop) ===
local function StartAutoFish()
    if Config.AutoFishing then return end
    Config.AutoFishing = true
    if autoToggle and autoToggle.Set then autoToggle:Set(true) end
    task.spawn(AutoFishingLoop_Robust)
    Notify("ğŸ£ AutoFishing", "Dilanjutkan.", 2)
end

local function StopAutoFish()
    if not Config.AutoFishing then return end
    Config.AutoFishing = false
    if autoToggle and autoToggle.Set then autoToggle:Set(false) end
    Notify("ğŸ£ AutoFishing", "Dijeda sementaraâ€¦", 2)
end

-- Expose name used in UI callbacks
AutoFishingLoop = AutoFishingLoop_Robust
TestStartMini = TestStartMini
RebindRemotes = RebindRemotes

------------------------------------------------------------
-- ğŸ£ Tab Auto
------------------------------------------------------------
local TabAuto = Window:CreateTab("ğŸ£ Auto Fishing")

local autoToggle = TabAuto:CreateToggle({
	Name = "Auto Fishing V1 (instan)",
	CurrentValue = false,
	Callback = function(val)
		Config.AutoFishing = val
		if val then
			Notify("ğŸ£ AutoFishing", "Dinyalakan â€” mencoba loop.", 2)
			task.spawn(AutoFishingLoop_Robust)
		else
			Notify("ğŸ£ AutoFishing", "Dimatikan.", 2)
		end
	end
})

TabAuto:CreateButton({
	Name = "ğŸ”¬ Test Auto Fishing",
	Callback = function()
		TestStartMini(-0.75, 0.99)
	end
})

TabAuto:CreateButton({
	Name = "ğŸ’° Sell All Fish",
	Callback = function()
		local sell = GetNetRemote("RF/SellAllItems")
		if sell then
			local ok = pcall(function()
				sell:InvokeServer()
			end)
			if ok then
				Rayfield:Notify({
					Title = "ğŸ’° Semua Ikan Terjual",
					Content = "Duit udah masuk kantong ğŸ¤‘",
					Duration = 3
				})
			else
				Rayfield:Notify({
					Title = "âš ï¸ Gagal Jual",
					Content = "Event gagal diakses ğŸ˜¢",
					Duration = 3
				})
			end
		end
	end
})

TabAuto:CreateSlider({
	Name = "Delay between actions",
	Range = {0.8, 3},
	Increment = 0.1,
	CurrentValue = Config.Delay,
	Callback = function(v) Config.Delay = v end
})


------------------------------------------------------------
-- ğŸ’œ ANTI-AFK HYBRID UNIVERSAL (PC + ANDROID) by bubb ğŸ˜ğŸ”¥
-- 100% Compatible with GPU Suspend
------------------------------------------------------------

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")

local IsMobile = UserInputService.TouchEnabled
local AntiAFK_Active = false

------------------------------------------------------------
-- ğŸ“± MOBILE / ANDROID: Touch Simulation (BEST)
------------------------------------------------------------
local function MobileActivity()
	pcall(function()
		-- Aman, tidak butuh rendering
		UserInputService:TouchTap(Vector2.new(150,150))
	end)
end

------------------------------------------------------------
-- ğŸ’» PC: VirtualUser (Strongest)
------------------------------------------------------------
local function PCActivity()
	pcall(function()
		VirtualUser:CaptureController()
		VirtualUser:ClickButton2(Vector2.new())
	end)
end

------------------------------------------------------------
-- ğŸ”„ MAIN LOOP
------------------------------------------------------------
local function AntiAFKLoop()
	task.spawn(function()
		while AntiAFK_Active do

			if IsMobile then
				-- Android-safe cycle
				MobileActivity()
				task.wait(12)   -- tidak terlalu cepat, aman
			else
				-- PC cycle
				PCActivity()
				task.wait(10)
			end

		end
	end)
end

------------------------------------------------------------
-- ğŸ”˜ TOGGLE UI
------------------------------------------------------------
local AntiAFK_Toggle = TabAuto:CreateToggle({
	Name = "ğŸ’¤ Anti-AFK (Hybrid Universal)",
	CurrentValue = false,
	Flag = "AntiAFK_Hybrid",
	Callback = function(Value)
		if Value then
			if AntiAFK_Active then return end
			AntiAFK_Active = true

			if IsMobile then
				Notify("ğŸ’¤ Anti-AFK", "Mode ANDROID aktif (Touch Simulation)", 3)
			else
				Notify("ğŸ’¤ Anti-AFK", "Mode PC aktif (VirtualUser)", 3)
			end

			AntiAFKLoop()

		else
			AntiAFK_Active = false
			Notify("ğŸ›‘ Anti-AFK", "Dimatikan.", 3)
		end
	end
})

------------------------------------------------------------
-- âš¡ AUTO START after UI Ready
------------------------------------------------------------
task.defer(function()
	AntiAFK_Active = true
	AntiAFK_Toggle:Set(true)
	AntiAFKLoop()
end)





--------------------------------------------------------------------
-- ğŸŸ£ GPU SUSPEND PRO (Ultra Battery Saver + Full Black Screen)
-- by bubb ğŸ˜ğŸ”¥
--------------------------------------------------------------------

local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")

local GpuSuspended = false
local FullBlackOverlay = nil

------------------------------------------------------------
-- ğŸŒ‘ FULL BLACK OVERLAY
------------------------------------------------------------
local function CreateFullBlackOverlay()
    local gui = Instance.new("ScreenGui")
    gui.Name = "FullBlackOverlay"
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    gui.Parent = CoreGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)
    frame.BackgroundTransparency = 0
    frame.BorderSizePixel = 0
    frame.ZIndex = 99999999
    frame.Parent = gui

    return gui
end

------------------------------------------------------------
-- ğŸ§Š GPU SUSPEND PRO ENGINE
------------------------------------------------------------
local function GpuSuspend(enable)
    GpuSuspended = enable

    if enable then
        ------------------------------------------------
        -- ğŸ”Œ Matikan semua rendering 3D
        ------------------------------------------------
        RunService:Set3dRenderingEnabled(false)

        ------------------------------------------------
        -- â˜ Matikan efek GPU berat
        ------------------------------------------------
        for _, effect in ipairs(Lighting:GetChildren()) do
            if effect:IsA("PostEffect")
            or effect:IsA("BloomEffect")
            or effect:IsA("DepthOfFieldEffect")
            or effect:IsA("SunRaysEffect")
            or effect:IsA("ColorCorrectionEffect") then
                effect.Enabled = false
            end
        end

        ------------------------------------------------
        -- ğŸŒ‘ Blackout screen
        ------------------------------------------------
        if not FullBlackOverlay then
            FullBlackOverlay = CreateFullBlackOverlay()
        else
            FullBlackOverlay.Enabled = true
        end

    else
        ------------------------------------------------
        -- ğŸ”„ Pulihkan rendering
        ------------------------------------------------
        RunService:Set3dRenderingEnabled(true)

        ------------------------------------------------
        -- ğŸŒ Hilangkan blackout
        ------------------------------------------------
        if FullBlackOverlay then
            FullBlackOverlay.Enabled = false
        end
    end
end

------------------------------------------------------------
-- ğŸ”˜ RAYFIELD TOGGLE
------------------------------------------------------------
TabAuto:CreateToggle({
    Name = "ğŸ”‹ Disable 3D Rendering",
    CurrentValue = false,
    Flag = "GpuSuspendToggle",
    Callback = function(value)
        GpuSuspend(value)
    end
})

--------------------------------------------------------------------
-- ğŸ”Œ AUTO RECONNECT (Same Server First, Else New Server)
-- by bubb ğŸ˜
--------------------------------------------------------------------
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

_G.AutoReconnect = false
_G.LastServerId = game.JobId -- simpan server saat ini saat script load

--------------------------------------------------------------------
-- ğŸŒ Cek server masih ada atau tidak
--------------------------------------------------------------------
local function CheckServerValid(jobId)
	local ok, result = pcall(function()
		return TeleportService:GetPlayerPlaceInstanceAsync(game.PlaceId, jobId)
	end)

	-- Kalau gagal fetch info = server sudah tidak valid
	if not ok or not result then
		return false
	end

	-- Kalau server full atau error
	if result.MaxPlayers and result.CurrentPlayers and result.CurrentPlayers >= result.MaxPlayers then
		return false
	end

	return true
end

--------------------------------------------------------------------
-- ğŸ” Fungsi utama reconnect
--------------------------------------------------------------------
local function AutoReconnectLoop()
	task.spawn(function()
		while _G.AutoReconnect do

			-- tunggu sampai player ke-kick / connection putus
			if LocalPlayer.Parent == nil then
				Rayfield:Notify({
					Title = "ğŸ”Œ Reconnecting...",
					Content = "Menunggu server lamaâ€¦",
					Duration = 3
				})

				local sameServer = CheckServerValid(_G.LastServerId)

				if sameServer then
					-- ğŸ”„ Reconnect ke server yang sama
					TeleportService:TeleportToPlaceInstance(
						game.PlaceId,
						_G.LastServerId,
						LocalPlayer
					)

				else
					-- ğŸ†• Server lama hilang â†’ masuk server baru
					Rayfield:Notify({
						Title = "ğŸŒ Server Lama Tidak Ada",
						Content = "Masuk server baru ya bubb ğŸ˜",
						Duration = 3
					})

					TeleportService:Teleport(game.PlaceId, LocalPlayer)
				end

				break
			end

			task.wait(2)
		end
	end)
end

--------------------------------------------------------------------
-- ğŸ”˜ Toggle Auto Reconnect
--------------------------------------------------------------------
TabAuto:CreateToggle({
	Name = "ğŸ”Œ Auto Reconnect",
	CurrentValue = false,
	Flag = "AutoReconnectToggle",
	Callback = function(state)
		_G.AutoReconnect = state

		if state then
			_G.LastServerId = game.JobId -- update id saat ini
			Rayfield:Notify({
				Title = "ğŸ”Œ Auto Reconnect Aktif",
				Content = "Akan kembali ke server ini dulu, atau ke server baru jika hilang.",
				Duration = 4
			})
			AutoReconnectLoop()
		else
			Rayfield:Notify({
				Title = "ğŸ›‘ Auto Reconnect Dimatikan",
				Content = "Tidak akan reconnect otomatis lagi.",
				Duration = 3
			})
		end
	end
})



------------------------------------------------------------
-- ğŸŒ TAB TELEPORT
------------------------------------------------------------
local TabTeleport = Window:CreateTab("ğŸŒ Teleport Menu")

------------------------------------------------------------
-- ğŸ—ºï¸ DAFTAR LOKASI TELEPORT
------------------------------------------------------------
local teleportLocations = {
    { Name = "Fisherman Island ğŸŸ", CFrame = CFrame.new(128.62, 3.53, 2783.18) },
    { Name = "Kohana Volcano ğŸŒ‹", CFrame = CFrame.new(-572.879456, 22.4521465, 148.355331) },
    { Name = "Sisyphus Statue ğŸ—¿",  CFrame = CFrame.new(-3727.16, -135.07, -1014.40) },
    { Name = "Coral Reefs ğŸ ",  CFrame = CFrame.new(-3114.78198, 1.32066584, 2237.52295) },
    { Name = "Esoteric Depths ğŸŒŠ",  CFrame = CFrame.new(3248.37109, -1301.53027, 1403.82727) },
    { Name = "Enchant Altar ğŸ”®",  CFrame = CFrame.new(3234.54, -1302.85, 1399.92) },
    { Name = "Crater Island ğŸŒ‹",  CFrame = CFrame.new(987.96, 3.30, 5148.49) },
    { Name = "Lost Isle ğŸŒ€",  CFrame = CFrame.new(-3618.15698, 240.836655, -1317.45801) },
    { Name = "Weather Machine ğŸŒ¦ï¸",  CFrame = CFrame.new(-1488.51196, 83.1732635, 1876.30298) },
    { Name = "Tropical Grove ğŸŒ´",  CFrame = CFrame.new(-2095.34106, 197.199997, 3718.08008) },
    { Name = "Treasure Room ğŸ’°",  CFrame = CFrame.new(-3606.34985, -266.57373, -1580.97339) },
    { Name = "Kohana ğŸï¸",  CFrame = CFrame.new(-663.904236, 3.04580712, 718.796875) },
    { Name = "Underground Cellar ğŸ•³ï¸", CFrame = CFrame.new(2135.89, -91.20, -698.50) },
    { Name = "Ancient Jungle ğŸŒ¿", CFrame = CFrame.new(1483.11, 11.14, -300.08) },
    { Name = "Sacred Temple â›©ï¸", CFrame = CFrame.new(1506.53, -22.13, -640.17) },
    { Name = "Ancient Ruin ğŸ•¸ï¸", CFrame = CFrame.new(6040.64, -578.44, 4715.02) },
    { Name = "Crystalline Passage â›“ï¸", CFrame = CFrame.new(6049.71, -538.90, 4385.69) },
    { Name = "Arrow Artifact ğŸ”º", CFrame = CFrame.new(881.40, 6.34, -346.27) },
    { Name = "Crescent Artifact ğŸŒ™", CFrame = CFrame.new(1404.67, 5.08, 120.55) },
    { Name = "Diamond Artifact ğŸ”·", CFrame = CFrame.new(1841.52, 2.76, -300.38) },
    { Name = "Hourglass Diamond Artifact ğŸ”¶", CFrame = CFrame.new(1466.40, 3.19, -846.62) },
}

------------------------------------------------------------
-- ğŸ“ Dropdown Teleport Lokasi
------------------------------------------------------------
local locationNames = {}
for _, loc in ipairs(teleportLocations) do table.insert(locationNames, loc.Name) end
table.sort(locationNames, function(a,b) return a:lower() < b:lower() end)

local selectedLocation = nil
local dropdown = TabTeleport:CreateDropdown({
	Name = "ğŸ“ Pilih Lokasi",
	Options = locationNames,
	CurrentOption = {},
	MultipleOptions = false,
	Callback = function(Value)
		selectedLocation = typeof(Value) == "table" and Value[1] or Value
		Notify("ğŸ“ Lokasi Dipilih", "Kamu pilih: " .. tostring(selectedLocation), 2)
	end
})

TabTeleport:CreateButton({
	Name = "ğŸš€ Teleport Now",
	Callback = function()
		if not selectedLocation then
			Notify("âš ï¸ Pilih Lokasi", "Pilih lokasi dulu.", 2)
			return
		end

		local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		if not hrp then
			Notify("âš ï¸ Gagal Teleport", "Karakter belum siap.", 2)
			return
		end

		local currentRotation = hrp.CFrame - hrp.CFrame.Position

		for _, loc in ipairs(teleportLocations) do
			if loc.Name == selectedLocation then
				pcall(function()
					hrp.CFrame = CFrame.new(loc.CFrame.Position) * currentRotation
				end)
				Notify("âœ¨ Teleport Sukses", loc.Name, 2)
				return
			end
		end
		Notify("âš ï¸ Error", "Lokasi tidak ditemukan (internal).", 2)
	end
})

------------------------------------------------------------
-- ğŸŒ¬ï¸ Radar & Diving Gear
------------------------------------------------------------
local EquipOxy = GetNetRemote("RF/EquipOxygenTank")
local UnequipOxy = GetNetRemote("RF/UnequipOxygenTank")
local Radar = GetNetRemote("RF/UpdateFishingRadar")

local function ToggleRadar(state)
    pcall(function() Radar:InvokeServer(state) end)
end

TabTeleport:CreateToggle({
    Name = "ğŸ“¡ Enable Radar",
    CurrentValue = false,
    Callback = function(Value) ToggleRadar(Value) end
})

local function ToggleDivingGear(state)
    pcall(function()
        if state then
            EquipTool:FireServer(2)
            EquipOxy:InvokeServer(105)
        else
            UnequipOxy:InvokeServer()
        end
    end)
end

TabTeleport:CreateToggle({
    Name = "ğŸ¤¿ Enable Diving Gear",
    CurrentValue = false,
    Callback = function(Value) ToggleDivingGear(Value) end
})

------------------------------------------------------------
-- ğŸ§­ Manual Teleport (Koordinat)
------------------------------------------------------------
TabTeleport:CreateSection("ğŸ§­ Manual Coordinate Teleport")
local customCoords = ""

TabTeleport:CreateInput({
    Name = "Koordinat (x, y, z)",
    PlaceholderText = "Contoh: 123.4, 5.6, 789.0",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text) customCoords = Text end
})

TabTeleport:CreateButton({
    Name = "ğŸš€ Teleport ke Koordinat",
    Callback = function()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then
            Notify("âš ï¸ Gagal Teleport", "Karakter belum siap.", 3)
            return
        end

        local x, y, z = string.match(customCoords or "", "([%-%d%.]+)%s*,%s*([%-%d%.]+)%s*,%s*([%-%d%.]+)")
        if not (x and y and z) then
            Notify("âš ï¸ Format Salah", "Gunakan format: x, y, z", 3)
            return
        end

        x, y, z = tonumber(x), tonumber(y), tonumber(z)
        local currentRotation = hrp.CFrame - hrp.CFrame.Position
        pcall(function() hrp.CFrame = CFrame.new(Vector3.new(x, y, z)) * currentRotation end)
        Notify("ğŸš€ Teleport Manual", string.format("X: %.2f | Y: %.2f | Z: %.2f", x, y, z), 3)
    end
})

------------------------------------------------------------
-- âš™ï¸ ADMIN EVENT FEATURES (Auto Teleport + Return to Last Pos)
------------------------------------------------------------
TabTeleport:CreateSection("âš™ï¸ Admin Event Features")

local adminHours = {3, 7, 11, 15, 19, 23}
local AutoAdminEnabled = false
local nextEventLabel
local lastCFrameBeforeEvent = nil

-- ğŸ•’ GMT+7
local function getGMT7Now()
	local utcNow = os.time(os.date("!*t"))
	local gmt7Epoch = utcNow + 7 * 3600
	local t = os.date("!*t", gmt7Epoch)
	return t, gmt7Epoch
end

local function formatHMS(totalSeconds)
	totalSeconds = math.max(0, math.floor(totalSeconds))
	local h = math.floor(totalSeconds / 3600)
	local m = math.floor((totalSeconds % 3600) / 60)
	local s = totalSeconds % 60
	return string.format("%dH %dM %dS", h, m, s)
end

local function getNextAdminEvent(nowT, nowEpoch)
	local secondsSinceMidnight = nowT.hour * 3600 + nowT.min * 60 + nowT.sec
	local midnightEpoch = nowEpoch - secondsSinceMidnight
	for _, hour in ipairs(adminHours) do
		local eventSeconds = hour * 3600
		if eventSeconds > secondsSinceMidnight then
			return midnightEpoch + eventSeconds, hour
		end
	end
	local tomorrowMidnight = midnightEpoch + 24 * 3600
	return tomorrowMidnight + adminHours[1] * 3600, adminHours[1]
end

-- ğŸ“ Lokasi teleport Admin Event
local adminEventCFrame = CFrame.new(6040.99, -578.44, 4715.02) * CFrame.Angles(0, math.rad(354.2), 0)

-- ğŸš€ Teleport ke Admin Event
local function TeleportToAdminEvent()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if not hrp then
		Notify("âš ï¸ Gagal Teleport", "Karakter belum siap.", 3)
		return
	end

	-- simpan posisi terakhir sebelum teleport
	lastCFrameBeforeEvent = hrp.CFrame

	-- teleport ke lokasi event
	hrp.CFrame = adminEventCFrame
	Notify("ğŸŸï¸ Teleport Admin Event", "Kamu sudah sampai di lokasi event!", 3)

	-- setelah bbrp menit (360 detik), balik ke posisi awal
	task.delay(630, function()
		if lastCFrameBeforeEvent and hrp then
			pcall(function()
				hrp.CFrame = lastCFrameBeforeEvent
				Notify("ğŸ•’ Selesai Event", "Kembali ke posisi sebelumnya ğŸ˜´", 4)
			end)
		end
	end)
end

-- â³ Label countdown
nextEventLabel = TabTeleport:CreateLabel("Event Countdown: --H --M --S")

-- ğŸ” Loop update countdown & auto teleport
task.spawn(function()
	while task.wait(1) do
		local nowT, nowEpoch = getGMT7Now()
		local nextEventEpoch, nextHour = getNextAdminEvent(nowT, nowEpoch)
		local diff = nextEventEpoch - nowEpoch
		nextEventLabel:Set(string.format("Event Countdown: %s", formatHMS(diff)))

		-- ğŸ•’ Auto teleport 5 detik sebelum event
		if AutoAdminEnabled and diff <= 10 and diff > 0 then
			-- keamanan biar gak teleport berkali-kali
			AutoAdminEnabled = false
			Notify("ğŸŸï¸ Auto Admin Event", 3)
			
			task.wait(5)
			TeleportToAdminEvent()
			
			-- aktifkan lagi otomatis setelah 2 menit (biar event berikutnya masih jalan)
			task.delay(120, function()
				AutoAdminEnabled = true
			end)
		end
	end
end)


-- ğŸ›ï¸ Toggle Auto Admin Event
TabTeleport:CreateToggle({
	Name = "Auto Admin Event (Teleport + Return)",
	CurrentValue = false,
	Callback = function(Value)
		AutoAdminEnabled = Value
		if Value then
			Notify("ğŸŸï¸ Auto Admin Event", "Akan otomatis teleport ke event.", 3)
		else
			Notify("ğŸ’¤ Auto Admin Event", "Mode otomatis dimatikan.", 3)
		end
	end
})



------------------------------------------------------------
-- ğŸš€ Teleport ke Admin Event (Manual Tanpa Kembali)
------------------------------------------------------------
local function TeleportToAdminEvent_Manual()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if not hrp then
		Notify("âš ï¸ Gagal Teleport", "Karakter belum siap untuk teleport.", 3)
		return
	end

	-- langsung teleport tanpa menyimpan posisi
	pcall(function()
		hrp.CFrame = adminEventCFrame
	end)

	Notify("ğŸš€ Teleport Admin Event (Manual)", "Kamu sudah sampai di lokasi event, bubb ğŸ’‹", 3)
end

------------------------------------------------------------
-- ğŸ§­ Tombol Manual Teleport (Tanpa Balik)
------------------------------------------------------------
TabTeleport:CreateButton({
	Name = "ğŸš€ Teleport Manual (Tanpa Balik)",
	Callback = function()
		TeleportToAdminEvent_Manual()
	end
})



------------------------------------------------------------
-- ğŸŒ¦ï¸ TAB WEATHER CONTROL
------------------------------------------------------------
local TabCuaca = Window:CreateTab("ğŸŒ¦ï¸ Weather Control")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RFPurchaseWeatherEvent = ReplicatedStorage
	:WaitForChild("Packages")
	._Index["sleitnick_net@0.2.0"]
	.net["RF/PurchaseWeatherEvent"]

-- Daftar Cuaca
local weatherOptions = {
	{ Name = "Wind (10.000)", Value = "Wind", Price = 10000 },
	{ Name = "Cloudy (20.000)", Value = "Cloudy", Price = 20000 },
	{ Name = "Storm (35.000)", Value = "Storm", Price = 35000 },
	{ Name = "Snow (15.000)", Value = "Snow", Price = 15000 },
	{ Name = "Radiant (50.000)", Value = "Radiant", Price = 50000 },
	{ Name = "Shark Hunt (300.000)", Value = "Shark Hunt", Price = 300000 },
}

-- Buat daftar nama untuk dropdown
local weatherNames = {}
for _, w in ipairs(weatherOptions) do
	table.insert(weatherNames, w.Name)
end

local selectedWeathers = {}
local AutoBuyEnabled = false

-- Dropdown multi-select
TabCuaca:CreateDropdown({
	Name = "ğŸŒ¤ï¸ Pilih Cuaca",
	Options = weatherNames,
	CurrentOption = {},
	MultipleOptions = true,
	Callback = function(Values)
		selectedWeathers = {}
		for _, v in ipairs(Values) do
			for _, w in ipairs(weatherOptions) do
				if v == w.Name then
					table.insert(selectedWeathers, w)
				end
			end
		end

		-- delay 2 detik sebelum tampil notif
		task.delay(2, function()
			if #selectedWeathers > 0 then
				local names = {}
				for _, w in ipairs(selectedWeathers) do
					table.insert(names, "âœ… " .. w.Value)
				end
			end
		end)
	end
})

-- Tombol beli semua cuaca
TabCuaca:CreateButton({
	Name = "ğŸ’¸ Beli Cuaca",
	Callback = function()
		if #selectedWeathers == 0 then
			-- Notify("âš ï¸ Belum ada cuaca dipilih", "Pilih dulu minimal 1 cuaca, bubb ğŸ’‹", 3)
			return
		end

		for i, w in ipairs(selectedWeathers) do
			pcall(function()
				RFPurchaseWeatherEvent:InvokeServer(w.Value)
				task.wait((#selectedWeathers > 1) and 3 or 0.25) -- jeda 1 detik kalau >1
			end)
		end

		-- Notify("ğŸŒ¦ï¸ Pembelian Cuaca", "Semua cuaca terpilih telah dibeli âœ…", 3)
	end
})


------------------------------------------------------------
-- âš™ï¸ AutoBuy Cuaca
------------------------------------------------------------
TabCuaca:CreateToggle({
	Name = "ğŸ•’ AutoBuy Cuaca",
	CurrentValue = false,
	Callback = function(Value)
		AutoBuyEnabled = Value

		if Value then
			Notify("ğŸ›’ AutoBuy dan Aktivate Cuaca", "", 3)
			task.spawn(function()
				while AutoBuyEnabled do
					if #selectedWeathers > 0 then
						for i, w in ipairs(selectedWeathers) do
							pcall(function()
								RFPurchaseWeatherEvent:InvokeServer(w.Value)
								task.wait((#selectedWeathers > 1) and 3 or 0.25) -- jeda 1 detik jika >1 cuaca
							end)
						end
					end
					task.wait(30) -- delay antar-loop utama
				end
			end)
		else
			Notify("ğŸ’¤ AutoBuy Cuaca Dimatikan", "Tidak lagi membeli otomatis.", 3)
		end
	end
})


------------------------------------------------------------
-- â™»ï¸ TAB 3: RESPAWN TOOLS
------------------------------------------------------------
local TabRespawn = Window:CreateTab("â™»ï¸ Respawn Tools")
-- TabRespawn:CreateSection("â™»ï¸ Respawn Tool")

------------------------------------------------------------
-- âš™ï¸ Variables
------------------------------------------------------------
local autoRespawnEnabled = false
local respawnInterval = 3600 -- default 60 menit
local respawnCount = 0
local countdownLabel
local sliderDelayTask

------------------------------------------------------------
-- ğŸ§  Helper Functions
------------------------------------------------------------
local function formatTime(seconds)
	local h = math.floor(seconds / 3600)
	local m = math.floor((seconds % 3600) / 60)
	local s = math.floor(seconds % 60)

	if h > 0 then
		return string.format("%dh %dm %ds", h, m, s)
	elseif m > 0 then
		return string.format("%dm %ds", m, s)
	else
		return string.format("%ds", s)
	end
end

local function safeGetHRP()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	return char:FindFirstChild("HumanoidRootPart")
end

------------------------------------------------------------
-- ğŸ§© CORE LOGIC (UID-BASED RARITY DETECTION SYSTEM)
------------------------------------------------------------

-- ğŸ”§ Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local player = game.Players.LocalPlayer

------------------------------------------------------------
-- ğŸ“¡ Remote Event Auto-Detect (biar aman di semua versi)
------------------------------------------------------------
local function getFishEvent()
	local Packages = ReplicatedStorage:WaitForChild("Packages")
	for _, pkg in ipairs(Packages._Index:GetChildren()) do
		if pkg:FindFirstChild("net") then
			local net = pkg.net
			if net:FindFirstChild("RE/ObtainedNewFishNotification") then
				return net["RE/ObtainedNewFishNotification"]
			end
		end
	end
	warn("[FishIt] âš ï¸ RE/ObtainedNewFishNotification tidak ditemukan.")
	return nil
end

local REObtainedNewFishNotification = getFishEvent()

------------------------------------------------------------
-- ğŸ§  UID Table Berdasarkan ItemId
------------------------------------------------------------
local FishUID = {
	Mythic = {
		15,21,34,35,47,52,54,75,97,98,122,137,146,147,150,185,205,
		215,240,247,249,263,264,273,308,314,316,336,347,352,355,357,367,371,372,373
	},
	Legendary = {
		14,16,22,24,25,36,37,48,53,73,86,110,138,152,199,207,208,
		224,236,243,274,283,286,296,299,307,311,317,334,338.346,356,365,366,369,370
	}
}

------------------------------------------------------------
-- ğŸ§© Fungsi Deteksi Rarity
------------------------------------------------------------
local function getRarityFromUID(id)
	for _, v in ipairs(FishUID.Mythic) do if v == id then return "Mythic" end end
	for _, v in ipairs(FishUID.Legendary) do if v == id then return "Legendary" end end
	return "Common"
end

------------------------------------------------------------
-- âš™ï¸ Variabel Global Tracking
------------------------------------------------------------
local rarityCounts = { Mythic = 0, Legendary = 0 }
local isRespawning = false
local leaderstats = player:WaitForChild("leaderstats")
local AllTimeCaught = leaderstats:WaitForChild("Caught")
local sessionStartCaught = AllTimeCaught.Value

------------------------------------------------------------
-- ğŸª„ Fungsi Notify Aman
------------------------------------------------------------
local function Notify(title, content, duration)
	pcall(function()
		Rayfield:Notify({
			Title = title,
			Content = content,
			Duration = duration or 3
		})
	end)
end

-- âœ… Inisialisasi Remote & Fungsi Toggle
local Autofish = GetNetRemote("RF/UpdateAutoFishingState")
local CurrentValue = false

local function ToggleAutoFishing(state)
    pcall(function()
        Autofish:InvokeServer(state)
        CurrentValue = state
        print("[AutoFishing]", state and "ON ğŸ£" or "OFF ğŸ’¤")
    end)
end

-- Simpan RespawnNow asli
local OldRespawnNow = RespawnNow
-- Override RespawnNow
function RespawnNow(force)
    -- âŒ Jika proteksi aktif dan bukan manual â†’ blokir
    if protectRareEnabled and protectActive and not force then
        print("[PROTECT] Respawn diblokir (auto). Manual boleh.")
        UpdateProtectLabel()
        return
    end

    -- âœ” Jika manual â†’ bypass
    if force then
        print("[FORCE] Manual respawn diizinkan (bypass proteksi).")
    end

    -- Jalankan respawn asli
    OldRespawnNow()
end


-- âœ… Fungsi Respawn Lengkap
function RespawnNow()
    if isRespawning then return end
    isRespawning = true

    task.spawn(function()
        ----------------------------------------------------------------
        -- â›” Matikan AutoFishing saat proses respawn mulai
        ----------------------------------------------------------------
        task.spawn(function()
            task.wait(2)
            ToggleAutoFishing(false)
        end)

        local willResume = Config and Config.AutoFishing
        if StopAutoFish then StopAutoFish() end

        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            Notify("âŒ Gagal Respawn", "HumanoidRootPart tidak ditemukan.", 3)
            isRespawning = false
            return
        end

        local lastCFrame = hrp.CFrame

        local function doRespawnOnce(idx)
            local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if hum then hum.Health = 0 end
            local newChar = player.CharacterAdded:Wait()
            newChar:WaitForChild("HumanoidRootPart", 10)
            task.wait(1)
            Notify("â™»ï¸ Respawn", ("Respawn #%d selesai"):format(idx), 2)
        end

        -- Respawn #1
        doRespawnOnce(1)
        task.wait(0.3)

        -- Jual ikan
        local sell = GetNetRemote and GetNetRemote("RF/SellAllItems")
        if sell then
            pcall(function()
                sell:InvokeServer()
                Notify("ğŸ’° Jual Ikan", "Semua ikan sudah dijual.", 2)
            end)
        end

        task.wait(1)

        -- Respawn #2
        doRespawnOnce(2)
        task.wait(0.3)

        -- Balik ke posisi semula
        local newHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if newHRP then
            newHRP.CFrame = lastCFrame
            Notify("ğŸ“ Kembali ke posisi & arah", "Sudah balik ke orientasi sebelumnya.", 3)
        end

        ----------------------------------------------------------------
        -- âœ… Kroscek sebelum nyalakan AutoFishing lagi
        ----------------------------------------------------------------
        task.wait(0.5)
        if CurrentValue == true then
            print("[AutoFishing] âš ï¸ Detected still ON before re-enable â€” resetting state...")
            ToggleAutoFishing(false)
            task.wait(0.3)
        end

        -- Sekarang nyalakan kembali
        ToggleAutoFishing(true)
        Notify("ğŸ£ AutoFishing", "AutoFishing kembali diaktifkan.", 3)

        ----------------------------------------------------------------
        -- ğŸ£ Equip pancing
        ----------------------------------------------------------------
        local equipRodEvent = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"]
            .net["RE/EquipToolFromHotbar"]
        if equipRodEvent then
            pcall(function()
                equipRodEvent:FireServer(1)
            end)
        end

        ----------------------------------------------------------------
        -- ğŸ”„ Reset counter rarity
        ----------------------------------------------------------------
        task.wait(0.2)
        rarityCounts = { Mythic = 0, Legendary = 0 }
        sessionStartCaught = AllTimeCaught.Value

        ----------------------------------------------------------------
        -- ğŸ’« Reset Anti-Stuck Counter setelah Respawn (FIX FINAL)
        ----------------------------------------------------------------
        if antiStuckEnabled then
            task.spawn(function()
                task.wait(1)
                fishSinceLastRare = 0
                lastCaughtForStuck = AllTimeCaught.Value
                print("[Anti-Stuck Reset] AllTimeCaught:", AllTimeCaught.Value)
                stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
                Rayfield:Notify({
                    Title = "ğŸ”„ Anti-Stuck Reset",
                    Content = "Jumlah ikan tanpa rare berhasil direset setelah respawn â™»ï¸",
                    Duration = 3
                })
            end)
        end

        isRespawning = false
    end)
end


------------------------------------------------------------
-- ğŸ”„ Listener Utama (UID Detection Event)
------------------------------------------------------------
local function connectFishListener()
	if REObtainedNewFishNotification then
		REObtainedNewFishNotification.OnClientEvent:Connect(function(_, _, fishData)
			if isRespawning or not fishData or not fishData.ItemId then return end

			local rarity = getRarityFromUID(fishData.ItemId)
			if rarity == "Mythic" then rarityCounts.Mythic += 1 end
			if rarity == "Legendary" then rarityCounts.Legendary += 1 end

			-- ğŸ” reset counter anti-stuck kalau dapat rare
			if rarity == "Mythic" or rarity == "Legendary" then
				fishSinceLastRare = 0
			end

			local totalRare = rarityCounts.Mythic + rarityCounts.Legendary
			if rarityLabel then
				rarityLabel:Set(string.format(
					"ğŸŸ  Legendary: %d | ğŸ”´ Mythic: %d | ğŸ£ Legendary + Mythic: %d",
					rarityCounts.Legendary,
					rarityCounts.Mythic,
					totalRare
				))
			end

			-- trigger rules (akan ditentukan di Bagian 2)
			if HandleRarityTrigger then
				HandleRarityTrigger(rarityCounts, RespawnNow)
			end
		end)
	else
		Notify("âš ï¸ Event Ikan Tidak Ditemukan", "Pastikan game masih sinkron dengan ReplicatedStorage", 5)
	end
end

connectFishListener()

------------------------------------------------------------
-- âš™ï¸ UI & MODE CONTROL SECTION (4 Mode Lengkap)
------------------------------------------------------------
TabRespawn:CreateSection("ğŸ‰ Auto Respawn by Rarity UID")

-- ğŸ”¢ Default Threshold Value
local legendThreshold = 7
local mythicThreshold = 2
local comboLegendNeeded = 2
local comboMythicNeeded = 1

-- ğŸ›ï¸ Mode Toggles
local enableLegendaryMode = false
local enableMythicMode = false
local enableMythicBeforeLegendaryMode = false
local enableComboMode = false

------------------------------------------------------------
-- ğŸ§  Fungsi Trigger Utama (HandleRarityTrigger)
------------------------------------------------------------
function HandleRarityTrigger(counts, RespawnNow)
	if isRespawning then return end
	local leg = counts.Legendary
	local myt = counts.Mythic
	local total = leg + myt

	if enableLegendaryMode and leg >= legendThreshold then
		Notify("ğŸŸ  Legendary Respawn", string.format("Mendapat %d Legendary â€“ respawn!", leg), 3)
		return RespawnNow()
	end

	if enableMythicMode and myt >= mythicThreshold then
		Notify("ğŸ”´ Mythic Respawn", string.format("Mendapat %d Mythic â€“ respawn!", myt), 3)
		return RespawnNow()
	end

	if enableMythicBeforeLegendaryMode and myt >= 2 and leg < legendThreshold then
		Notify("ğŸ‰ Trigger", "2 Mythic didapat sebelum 7 Legendary â€“ respawn ğŸ’€", 4)
		return RespawnNow()
	end

	local waitingComboNotified = false

	if enableComboMode then
		if myt > 1 and leg < comboLegendNeeded then
			Notify("ğŸ”´ Mythic Priority", string.format("Mendapat %d Mythic sebelum %d Legendary â€“ respawn!", myt, comboLegendNeeded), 4)
			waitingComboNotified = false
			return RespawnNow()
		end

		if leg > comboLegendNeeded and myt == 0 then
			if not waitingComboNotified then
				waitingComboNotified = true
			end
			return
		end

		if leg > comboLegendNeeded and myt >= 1 then
			Notify("âš¡ Combo Triggered", string.format("%d Legendary + %d Mythic â€“ respawn!", leg, myt), 4)
			waitingComboNotified = false
			return RespawnNow()
		end

		if leg == comboLegendNeeded and myt == comboMythicNeeded then
			Notify("ğŸ’¥ Combo Aktif", string.format("%d Legendary + %d Mythic â€“ pantau Mythic berikutnya âš¡", leg, myt), 3)
			waitingComboNotified = false
			return
		end
	end
end

------------------------------------------------------------
-- ğŸ·ï¸ Label Status
------------------------------------------------------------
rarityLabel = TabRespawn:CreateLabel("ğŸŸ  Legendary: 0 | ğŸ”´ Mythic: 0 | ğŸ£ Legendary + Mythic: 0")

------------------------------------------------------------
-- ğŸŸ  Mode 1 â€“ Legendary
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "ğŸŸ  Batas Legendary untuk Respawn",
	Range = {1, 15},
	Increment = 1,
	CurrentValue = 5,
	Callback = function(v)
		legendThreshold = v
		Notify("ğŸŸ  Threshold Legendary Diubah", string.format("Respawn saat mendapat %d Legendary", v), 3)
	end
})

TabRespawn:CreateToggle({
	Name = "ğŸŸ  Aktifkan Auto Respawn Legendary",
	CurrentValue = false,
	Callback = function(v)
		enableLegendaryMode = v
		rarityCounts = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸŸ  Mode Legendary Aktif", "Respawn otomatis jika batas Legend tercapai.", 4)
		else
			Notify("ğŸ§Š Mode Legendary Mati", "Berhenti pantau ikan legendary.", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ”´ Mode 2 â€“ Mythic
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "ğŸ”´ Batas Mythic untuk Respawn",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = 3,
	Callback = function(v)
		mythicThreshold = v
		Notify("ğŸ”´ Threshold Mythic Diubah", string.format("Respawn saat mendapat %d Mythic", v), 3)
	end
})

TabRespawn:CreateToggle({
	Name = "ğŸ”´ Aktifkan Auto Respawn Mythic",
	CurrentValue = false,
	Callback = function(v)
		enableMythicMode = v
		rarityCounts = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ”´ Mode Mythic Aktif", "Respawn otomatis jika batas Mythic tercapai.", 4)
		else
			Notify("ğŸ§Š Mode Mythic Mati", "Berhenti pantau ikan mythic.", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ‰ Mode 3 â€“ 2 Mythic Before Legendary
------------------------------------------------------------
TabRespawn:CreateToggle({
	Name = "ğŸ‰ Respawn jika dapat Mythic sebelum Legendary penuh",
	CurrentValue = false,
	Callback = function(v)
		enableMythicBeforeLegendaryMode = v
		rarityCounts = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ‰ Mode Aktif", "Respawn jika 2 Mythic muncul lebih awal.", 4)
		else
			Notify("ğŸ§Š Mode Mati", "Berhenti pantau Mythic awal.", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ’¥ Mode 4 â€“ Combo (Legendary + Mythic Priority)
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "ğŸŸ  Jumlah Legendary Combo",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = 2,
	Callback = function(v)
		comboLegendNeeded = v
		Notify("ğŸŸ  Combo Legendary Diubah", string.format("Dibutuhkan %d Legendary dalam combo", v), 3)
	end
})

TabRespawn:CreateSlider({
	Name = "ğŸ”´ Jumlah Mythic Combo",
	Range = {1, 5},
	Increment = 1,
	CurrentValue = 1,
	Callback = function(v)
		comboMythicNeeded = v
		Notify("ğŸ”´ Combo Mythic Diubah", string.format("Dibutuhkan %d Mythic dalam combo", v), 3)
	end
})

TabRespawn:CreateToggle({
	Name = "ğŸ’¥ Mode Kombinasi (Legendary + Mythic Priority)",
	CurrentValue = false,
	Callback = function(v)
		enableComboMode = v
		rarityCounts = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ’¥ Mode Combo Aktif", string.format("Respawn setelah %d Legendary & %d Mythic (Mythic prioritas) âš¡", comboLegendNeeded, comboMythicNeeded), 4)
		else
			Notify("ğŸ§Š Mode Combo Mati", "Pantauan combo dinonaktifkan ğŸ’¤", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸŸ Auto Respawn Berdasarkan Jumlah Ikan (Reset Setelah Respawn)
------------------------------------------------------------
local fishBasedRespawnEnabled = false
local lastCaught = 0
local caughtThreshold = 1000
local leaderstats = player:WaitForChild("leaderstats")
local AllTimeCaught = leaderstats:WaitForChild("Caught")

------------------------------------------------------------
-- ğŸ“ˆ Label Progress
------------------------------------------------------------
local fishProgressLabel = TabRespawn:CreateLabel("ğŸŸ Next respawn after: 0 / " .. caughtThreshold)

------------------------------------------------------------
-- ğŸ§  Fungsi Restart Counter (dipanggil setelah respawn)
------------------------------------------------------------
local function ResetFishCounter()
    lastCaught = AllTimeCaught.Value
    fishProgressLabel:Set(string.format("ğŸŸ Next respawn after: 0 / %d (0%%)", caughtThreshold))
    Rayfield:Notify({
        Title = "â™»ï¸ Counter Reset",
        Content = "Progress ikan telah direset setelah respawn ğŸ£",
        Duration = 3
    })
end

------------------------------------------------------------
-- ğŸ”„ Listener Reset Setelah Respawn
------------------------------------------------------------
player.CharacterAdded:Connect(function(newChar)
    if not fishBasedRespawnEnabled then return end
    task.spawn(function()
        newChar:WaitForChild("HumanoidRootPart", 10)
        task.wait(1)
        ResetFishCounter()
    end)
end)

------------------------------------------------------------
-- ğŸ§© LOOP AUTO-RESPAWN
------------------------------------------------------------
task.spawn(function()
    while task.wait(1) do
        if not fishBasedRespawnEnabled then
            fishProgressLabel:Set("ğŸŸ Next respawn after: -- / --")
            continue
        end

        local now = AllTimeCaught.Value
        local diff = now - lastCaught
        local percent = math.min(100, math.floor((diff / caughtThreshold) * 100))

        fishProgressLabel:Set(string.format("ğŸŸ Next respawn after: %d / %d (%d%%)", diff, caughtThreshold, percent))

        if diff >= caughtThreshold then
            Rayfield:Notify({
                Title = "â™»ï¸ Auto Respawn Triggered",
                Content = string.format("Menangkap %d ikan, respawn dimulai ğŸŸ", diff),
                Duration = 4
            })

            RespawnNow()
            ResetFishCounter()
        end
    end
end)

------------------------------------------------------------
-- ğŸ›ï¸ TOGGLE ENABLE / DISABLEk
------------------------------------------------------------
TabRespawn:CreateToggle({
    Name = "ğŸŸ Auto Respawn by Fish Count",
    CurrentValue = false,
    Callback = function(Value)
        fishBasedRespawnEnabled = Value
        if Value then
            ResetFishCounter()
            Rayfield:Notify({
                Title = "ğŸŸ Auto Respawn Aktif",
                Content = string.format("Respawn otomatis tiap %d ikan ğŸ£", caughtThreshold),
                Duration = 4
            })
        else
            Rayfield:Notify({
                Title = "âŒ Auto Respawn Mati",
                Content = "Respawn berdasarkan ikan dimatikan ğŸ’‹",
                Duration = 3
            })
        end
    end
})

------------------------------------------------------------
-- ğŸšï¸ SLIDER
------------------------------------------------------------
local sliderNotifyDelay
TabRespawn:CreateSlider({
    Name = "ğŸšï¸ Set Jumlah Ikan per Respawn",
    Range = {100, 5000},
    Increment = 100,
    CurrentValue = caughtThreshold,
    Callback = function(Value)
        caughtThreshold = math.floor(Value)
        if sliderNotifyDelay then
            task.cancel(sliderNotifyDelay)
        end
        sliderNotifyDelay = task.delay(2, function()
            Rayfield:Notify({
                Title = "ğŸ£ Batas Ikan Diubah",
                Content = string.format("Respawn setiap %d ikan tertangkap ğŸŸ", caughtThreshold),
                Duration = 3
            })
        end)
    end
})


------------------------------------------------------------
-- ğŸ’« ANTI-STUCK SYSTEM (RESET DENGAN TOGGLE AUTO-REFRESH)
------------------------------------------------------------
local antiStuckEnabled = false
local noRareLimit = 300
local fishSinceLastRare = 0
local lastCaughtForStuck = AllTimeCaught.Value
local stuckProgressLabel = TabRespawn:CreateLabel("ğŸ’« Ikan tanpa rare: -- / --")

-- Simpan referensi toggle biar bisa diubah dari script
local toggleAntiStuck

------------------------------------------------------------
-- ğŸ§© Fungsi Aktifkan/Matikan Anti-Stuck (biar bisa dipanggil internal)
------------------------------------------------------------
local function SetAntiStuckState(state)
	antiStuckEnabled = state
	if state then
		fishSinceLastRare = 0
		lastCaughtForStuck = AllTimeCaught.Value
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
	else
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: -- / --")
	end
end

------------------------------------------------------------
-- ğŸ§¿ TOGGLE UTAMA
------------------------------------------------------------
toggleAntiStuck = TabRespawn:CreateToggle({
	Name = "ğŸ’« Aktifkan Anti-Stuck (No Rare Respawn)",
	CurrentValue = false,
	Callback = function(v)
		SetAntiStuckState(v)
		if v then
			Rayfield:Notify({
				Title = "ğŸ’« Anti-Stuck Aktif",
				Content = string.format("Respawn jika tidak ada rare dalam %d ikan ğŸŸ", noRareLimit),
				Duration = 4
			})
		else
			Rayfield:Notify({
				Title = "ğŸ§Š Anti-Stuck Dimatikan",
				Content = "Pantauan ikan tanpa rare dihentikan ğŸ’‹",
				Duration = 3
			})
		end
	end
})
------------------------------------------------------------
-- ğŸšï¸ SLIDER
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "ğŸŸ Batas Ikan Tanpa Rare Sebelum Respawn",
	Range = {100, 5000},
	Increment = 100,
	CurrentValue = noRareLimit,
	Callback = function(v)
		noRareLimit = math.floor(v)

		if antiStuckEnabled then
			stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
		end

		-- â³ Tambahkan delay 2 detik sebelum notifikasi muncul
		task.spawn(function()
			task.wait(2)
			Rayfield:Notify({
				Title = "ğŸŸ Batas Diubah",
				Content = "Respawn otomatis jika tidak ada rare dalam " .. noRareLimit .. " ikan.",
				Duration = 3
			})
		end)
	end
})

------------------------------------------------------------
-- ğŸ” LOOP ANTI-STUCK (REALTIME FIX)
------------------------------------------------------------
local function StartAntiStuckLoop()
	-- Hentikan loop lama kalau ada
	if _G.AntiStuckLoop then
		task.cancel(_G.AntiStuckLoop)
	end

	-- Reset label & counter dulu
	fishSinceLastRare = 0
	lastCaughtForStuck = AllTimeCaught.Value
	stuckProgressLabel:Set(string.format("ğŸ’« Ikan tanpa rare: %d / %d (0%%)", fishSinceLastRare, noRareLimit))

	-- ğŸ§  Pastikan kita dengarkan event perubahan jumlah ikan
	if _G.AntiStuckConn then
		_G.AntiStuckConn:Disconnect()
	end

	_G.AntiStuckConn = AllTimeCaught.Changed:Connect(function(newValue)
		if not antiStuckEnabled then return end

		local diff = newValue - lastCaughtForStuck
		if diff <= 0 then return end

		fishSinceLastRare += diff
		lastCaughtForStuck = newValue

		local percent = math.min(100, math.floor((fishSinceLastRare / noRareLimit) * 100))
		stuckProgressLabel:Set(string.format("ğŸ’« Ikan tanpa rare: %d / %d (%d%%)", fishSinceLastRare, noRareLimit, percent))

		-- Jika sudah lewat batas dan belum dapat rare â†’ respawn
		if fishSinceLastRare >= noRareLimit then
			if (rarityCounts.Legendary < legendThreshold) and (rarityCounts.Mythic < mythicThreshold) then
				Rayfield:Notify({
					Title = "ğŸ˜´ Tidak Ada Rare",
					Content = string.format("Sudah %d ikan tanpa Legendary/Mythic, respawn otomatis ğŸŒ€", noRareLimit),
					Duration = 4
				})
				RespawnNow() -- bisa juga diganti RespawnNowRandom() kalau mau random
				task.wait(0.5)
				fishSinceLastRare = 0
				lastCaughtForStuck = AllTimeCaught.Value
			else
				fishSinceLastRare = 0
				lastCaughtForStuck = AllTimeCaught.Value
				stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
			end
		end
	end)

	Rayfield:Notify({
		Title = "ğŸ’« Anti-Stuck Aktif",
		Content = "Sistem pemantau ikan tanpa rare sedang berjalan real-time ğŸŸ",
		Duration = 4
	})
end


------------------------------------------------------------
-- ğŸ§  Listener: Mulai ulang loop setelah respawn
------------------------------------------------------------
player.CharacterAdded:Connect(function(newChar)
	if not antiStuckEnabled then return end

	task.spawn(function()
		newChar:WaitForChild("HumanoidRootPart", 10)
		task.wait(1)

		fishSinceLastRare = 0
		lastCaughtForStuck = AllTimeCaught.Value
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")

		Rayfield:Notify({
			Title = "ğŸ”„ Anti-Stuck Reset",
			Content = "Counter direset & loop dimulai ulang setelah respawn â™»ï¸",
			Duration = 3
		})

		StartAntiStuckLoop()
	end)
end)

------------------------------------------------------------
-- ğŸ§© Jalankan loop pertama kali
------------------------------------------------------------
StartAntiStuckLoop()


------------------------------------------------------------
-- ğŸ›¡ï¸ PROTEKSI RESPAWN DENGAN SLIDER & LABEL DINAMIS
------------------------------------------------------------
local protectRespawnEnabled = false
local protectMinFishLimit = 500
local protectMaxFishLimit = 4000
local lastProtectCaught = AllTimeCaught.Value

-- Threshold proteksi (bisa diatur lewat slider)
local protectLegendaryNeeded = 3
local protectMythicNeeded = 2
local protectComboLegendNeeded = 2
local protectComboMythicNeeded = 1

-- Counter rare session
local protectCounts = { Legendary = 0, Mythic = 0 }

-- Label dinamis
local protectProgressLabel = TabRespawn:CreateLabel(
	"ğŸ›¡ï¸ Progress Proteksi: ğŸ”´ OFF | 0/500 | 0/4000 | ğŸŸ  Legendary: 0 | ğŸ”´ Mythic: 0"
)

------------------------------------------------------------
-- ğŸ§  Helper Update Label
------------------------------------------------------------
local function UpdateProtectLabel()
	local status = protectRespawnEnabled and "ğŸŸ¢ ON" or "ğŸ”´ OFF"
	local diff = AllTimeCaught.Value - lastProtectCaught
	protectProgressLabel:Set(string.format(
		"ğŸ›¡ï¸ Progress Proteksi: %s | %d/%d | %d/%d | ğŸŸ  %d | ğŸ”´ %d",
		status,
		math.min(diff, protectMinFishLimit),
		protectMinFishLimit,
		math.min(diff, protectMaxFishLimit),
		protectMaxFishLimit,
		protectCounts.Legendary,
		protectCounts.Mythic
	))
end

------------------------------------------------------------
-- ğŸ§  Reset Counter Proteksi
------------------------------------------------------------
local function ResetProtectCounter()
	lastProtectCaught = AllTimeCaught.Value
	protectCounts = { Legendary = 0, Mythic = 0 }
	UpdateProtectLabel()
	Rayfield:Notify({
		Title = "ğŸ›¡ï¸ Proteksi Direset",
		Content = "Counter proteksi direset setelah respawn â™»ï¸",
		Duration = 3
	})
end

------------------------------------------------------------
-- ğŸ” Reset Setelah Respawn
------------------------------------------------------------
player.CharacterAdded:Connect(function(newChar)
	if not protectRespawnEnabled then return end
	task.spawn(function()
		newChar:WaitForChild("HumanoidRootPart", 10)
		task.wait(1)
		ResetProtectCounter()
	end)
end)

------------------------------------------------------------
-- ğŸ“Š Update Realtime Progress
------------------------------------------------------------
task.spawn(function()
	while task.wait(1) do
		if not protectRespawnEnabled then
			UpdateProtectLabel()
			continue
		end

		UpdateProtectLabel()

		local diff = AllTimeCaught.Value - lastProtectCaught
		if diff >= protectMaxFishLimit then
			Rayfield:Notify({
				Title = "â° Batas Maksimum Tercapai",
				Content = string.format("Sudah %d ikan tanpa trigger proteksi â€” respawn otomatis ğŸ’«", protectMaxFishLimit),
				Duration = 4
			})
			RespawnNow()
			ResetProtectCounter()
		end
	end
end)

------------------------------------------------------------
-- ğŸ“¡ Listener Proteksi Rare
------------------------------------------------------------
local function connectProtectListener()
	if REObtainedNewFishNotification then
		REObtainedNewFishNotification.OnClientEvent:Connect(function(_, _, fishData)
			if not protectRespawnEnabled or not fishData or not fishData.ItemId then return end

			local rarity = getRarityFromUID(fishData.ItemId)
			if rarity == "Legendary" then protectCounts.Legendary += 1 end
			if rarity == "Mythic" then protectCounts.Mythic += 1 end
			UpdateProtectLabel()

			local totalCaught = AllTimeCaught.Value - lastProtectCaught

			-- Aktif hanya sebelum batas minimum
			if totalCaught <= protectMinFishLimit then
				-- ğŸŸ  Legendary-only
				if protectCounts.Legendary >= protectLegendaryNeeded then
					Rayfield:Notify({
						Title = "ğŸŸ  Proteksi Legendary",
						Content = string.format("Mendapat %d Legendary sebelum %d ikan ğŸ¯ â€” respawn!", protectCounts.Legendary, protectMinFishLimit),
						Duration = 4
					})
					RespawnNow()
					ResetProtectCounter()
					return
				end

				-- ğŸ”´ Mythic-only
				if protectCounts.Mythic >= protectMythicNeeded then
					Rayfield:Notify({
						Title = "ğŸ”´ Proteksi Mythic",
						Content = string.format("Mendapat %d Mythic sebelum %d ikan ğŸ‰ â€” respawn!", protectCounts.Mythic, protectMinFishLimit),
						Duration = 4
					})
					RespawnNow()
					ResetProtectCounter()
					return
				end

				-- âš¡ Kombinasi (Legend + Mythic)
				if protectCounts.Legendary >= protectComboLegendNeeded and protectCounts.Mythic >= protectComboMythicNeeded then
					Rayfield:Notify({
						Title = "âš¡ Combo Proteksi Respawn",
						Content = string.format("%d Legendary + %d Mythic sebelum %d ikan â€” respawn âš¡", protectCounts.Legendary, protectCounts.Mythic, protectMinFishLimit),
						Duration = 4
					})
					RespawnNow()
					ResetProtectCounter()
					return
				end
			end
		end)
	else
		Notify("âš ï¸ Event Proteksi Tidak Ditemukan", "Pastikan RE/ObtainedNewFishNotification valid", 5)
	end
end

connectProtectListener()

------------------------------------------------------------
-- ğŸšï¸ Slider: Batas Minimum
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "ğŸ”° Batas Minimum Proteksi (Default 500)",
	Range = {100, 2000},
	Increment = 50,
	CurrentValue = protectMinFishLimit,
	Callback = function(v)
		protectMinFishLimit = math.floor(v)
		UpdateProtectLabel()
		Rayfield:Notify({
			Title = "âš™ï¸ Batas Minimum Diperbarui",
			Content = string.format("Proteksi berlaku untuk %d ikan pertama ğŸ£", protectMinFishLimit),
			Duration = 3
		})
	end
})

------------------------------------------------------------
-- ğŸšï¸ Slider: Batas Maksimum
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "â° Batas Maksimum (Default 4000)",
	Range = {500, 10000},
	Increment = 100,
	CurrentValue = protectMaxFishLimit,
	Callback = function(v)
		protectMaxFishLimit = math.floor(v)
		UpdateProtectLabel()
		Rayfield:Notify({
			Title = "â° Batas Maksimum Diperbarui",
			Content = string.format("Respawn otomatis jika sudah mencapai %d ikan ğŸŸ", protectMaxFishLimit),
			Duration = 3
		})
	end
})

------------------------------------------------------------
-- ğŸšï¸ SLIDER PROTEKSI KHUSUS (3 Trigger)
------------------------------------------------------------
-- ğŸŸ  Legendary Trigger
TabRespawn:CreateSlider({
	Name = "ğŸŸ  Proteksi Legendary Trigger",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = protectLegendaryNeeded,
	Callback = function(v)
		protectLegendaryNeeded = math.floor(v)
		Rayfield:Notify({
			Title = "ğŸŸ  Proteksi Legendary Diubah",
			Content = string.format("Respawn jika mendapat %d Legendary sebelum batas proteksi ğŸ¯", protectLegendaryNeeded),
			Duration = 3
		})
	end
})

-- ğŸ”´ Mythic Trigger
TabRespawn:CreateSlider({
	Name = "ğŸ”´ Proteksi Mythic Trigger",
	Range = {1, 5},
	Increment = 1,
	CurrentValue = protectMythicNeeded,
	Callback = function(v)
		protectMythicNeeded = math.floor(v)
		Rayfield:Notify({
			Title = "ğŸ”´ Proteksi Mythic Diubah",
			Content = string.format("Respawn jika mendapat %d Mythic sebelum batas proteksi ğŸ‰", protectMythicNeeded),
			Duration = 3
		})
	end
})

-- âš¡ Combo Trigger
TabRespawn:CreateSlider({
	Name = "âš¡ Proteksi Kombinasi (Legend + Mythic)",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = protectComboLegendNeeded,
	Callback = function(v)
		protectComboLegendNeeded = math.floor(v)
		Rayfield:Notify({
			Title = "âš¡ Proteksi Kombinasi Diubah",
			Content = string.format("Respawn jika mendapat %d Legendary + %d Mythic sebelum batas proteksi âš¡", protectComboLegendNeeded, protectComboMythicNeeded),
			Duration = 3
		})
	end
})

------------------------------------------------------------
-- ğŸ”˜ Toggle Proteksi Respawn
------------------------------------------------------------
TabRespawn:CreateToggle({
	Name = "ğŸ›¡ï¸ Aktifkan Proteksi Respawn (Rare Sebelum 500 / Maks 4000)",
	CurrentValue = false,
	Callback = function(v)
		protectRespawnEnabled = v
		if v then
			ResetProtectCounter()
			UpdateProtectLabel()
			Rayfield:Notify({
				Title = "ğŸ›¡ï¸ Proteksi Aktif",
				Content = string.format("Respawn otomatis jika rare muncul sebelum %d ikan, atau otomatis di %d ikan ğŸŸ", protectMinFishLimit, protectMaxFishLimit),
				Duration = 4
			})
		else
			UpdateProtectLabel()
			Rayfield:Notify({
				Title = "ğŸ§Š Proteksi Dimatikan",
				Content = "Sistem proteksi respawn dinonaktifkan ğŸ’‹",
				Duration = 3
			})
		end
	end
})


------------------------------------------------------------
-- â±ï¸ Timer Countdown Loop
------------------------------------------------------------
local function startCountdown()
	task.spawn(function()
		local remaining = respawnInterval
		while autoRespawnEnabled and remaining > 0 do
			countdownLabel:Set("ğŸ• Next respawn in: " .. formatTime(remaining))
			task.wait(1)
			remaining -= 1
		end
		countdownLabel:Set("ğŸ• Next respawn in: --")

		if autoRespawnEnabled then
			RespawnNow()
			task.wait(3)
			startCountdown()
		end
	end)
end

------------------------------------------------------------
-- ğŸ•’ Label Countdown
------------------------------------------------------------
countdownLabel = TabRespawn:CreateLabel("ğŸ• Next respawn in: --")

------------------------------------------------------------
-- ğŸ”˜ Toggle Auto Respawn
------------------------------------------------------------
TabRespawn:CreateToggle({
	Name = "â™»ï¸ Auto Respawn Loop",
	CurrentValue = false,
	Callback = function(Value)
		autoRespawnEnabled = Value
		if Value then
			Rayfield:Notify({
				Title = "â™»ï¸ Auto Respawn Aktif",
				Content = string.format("Respawn otomatis tiap %.0f menit ğŸ˜´", respawnInterval / 60),
				Duration = 4
			})
			startCountdown()
		else
			countdownLabel:Set("ğŸ• Next respawn in: --")
			Rayfield:Notify({
				Title = "âŒ Auto Respawn Dimatikan",
				Content = "Respawn otomatis dihentikan ğŸ’‹",
				Duration = 3
			})
		end
	end
})

------------------------------------------------------------
-- â±ï¸ Interval Respawn Slider
------------------------------------------------------------
TabRespawn:CreateSlider({
	Name = "â±ï¸ Interval Respawn (menit)",
	Range = {1, 300},
	Increment = 1,
	CurrentValue = respawnInterval / 60,
	Callback = function(Value)
		respawnInterval = Value * 60
		if sliderDelayTask then
			task.cancel(sliderDelayTask)
		end
		sliderDelayTask = task.delay(2, function()
			Rayfield:Notify({
				Title = "â±ï¸ Interval Diperbarui",
				Content = string.format("Respawn tiap %.0f menit (%s)", Value, formatTime(Value * 60)),
				Duration = 3
			})
			sliderDelayTask = nil
		end)
	end
})

------------------------------------------------------------
-- ğŸ”˜ Tombol Manual Respawn
------------------------------------------------------------
TabRespawn:CreateButton({
	Name = "ğŸ”„ Respawn Sekarang (Manual)",
	Callback = function()
		RespawnNow(true)
	end
})

------------------------------------------------------------
-- â™»ï¸ TAB: RESPAWN RANDOM
------------------------------------------------------------
local TabRespawnRandom = Window:CreateTab("â™»ï¸ Respawn Random")

------------------------------------------------------------
-- ğŸŒ Daftar Lokasi Teleport
------------------------------------------------------------
local teleportList = {
    {-562.25,8.75,-66.47,185.0},{-931.43,21.14,592.11,261.6},{-939.05,16.75,634.41,268.2},
    {-903.29,16.75,632.26,88.4},{-860.46,18.75,466.78,88.4},{-916.71,19.06,456.30,273.6},
    {-993.95,15.78,403.85,190.1},{-930.88,17.50,401.24,225.5},{-922.42,24.50,370.41,267.9},
    {-828.11,17.50,407.45,118.6},{-840.55,43.10,366.13,85.4},{-830.04,53.50,216.11,85.4},
    {-654.26,17.25,449.99,268.6},{-587.11,17.25,457.99,77.0},{-603.49,3.10,558.02,59.8},
    {-654.82,2.20,543.63,276.0},{-623.54,2.79,698.67,90.4},{-370.80,6.63,520.69,354.5},
    {-394.43,13.75,477.15,182.9},{-358.07,4.75,487.52,182.8},{-2957.63,66.40,2208.07,89.7},
    {-2940.75,66.25,2209.77,266.3},{-3103.87,6.42,2217.77,254.8},{-3140.96,2.34,2125.65,3.3},
    {-3206.86,3.12,2105.37,13.9},{-3237.18,10.07,2131.59,59.9},{-3271.77,2.50,2231.10,105.4},
    {-3240.85,7.15,2277.41,143.2},{-3030.59,2.52,2287.01,86.9},{-2921.72,3.25,2082.21,75.2},
    {-2753.68,4.01,2105.15,263.1},{3188.01,-1302.10,1366.95,248.7},{3230.64,-1302.10,1455.41,342.4},
    {3263.51,-1302.10,1333.10,154.9},{3304.97,-1302.10,1421.34,70.5},{3273.58,-1301.53,1384.71,297.3},
    {3250.72,-1293.51,1435.31,26.5},{3218.36,-1293.80,1365.76,206.1},{198.37,3.22,2799.67,321.9},
    {260.08,3.19,2948.22,285.2},{220.60,3.22,3052.32,247.5},{82.94,3.26,3141.14,192.0},
    {-23.63,3.18,3139.72,176.4},{-95.85,3.01,3104.86,182.4},{-135.75,3.26,3053.96,79.7},
    {-80.68,3.26,2874.68,28.7},{-168.03,3.26,2961.94,231.4},{-214.13,3.26,2909.88,90.5},
    {-107.88,3.26,2848.26,277.8},{-108.14,32.23,2847.89,258.5},{-86.81,18.53,2834.54,181.4},
    {-86.88,18.53,2814.65,358.6},{-175.75,3.26,2775.72,47.8},{39.09,3.22,2762.25,8.0},
    {85.93,9.57,2691.10,93.2},{-2110.59,6.27,3689.77,342.6},{-2095.57,6.27,3654.41,148.1},{-2002.13,4.03,3682.70,312.2},{-2012.50,5.77,3756.10,165.9},
    {-2043.80,4.75,3819.17,31.5},{-2054.07,9.00,3777.46,175.5},{-2110.96,6.33,3813.89,275.1},
    {-2071.43,7.61,3845.78,28.9},{-2151.83,2.38,3670.99,29.3},{-2164.80,2.83,3639.15,220.1},
    {-1539.16,2.87,1916.74,190.6},{-1493.22,3.50,1915.87,152.1},{-1557.82,8.74,1797.09,35.6},
    {-1635.25,8.13,1874.11,75.8},{-2146.44,53.49,3676.09,1.2},{-2175.29,53.49,3637.36,247.3},
	{-2129.36,53.49,3633.35,139.4}
}

------------------------------------------------------------
-- ğŸ”€ Random offset 0.01 - 0.09 (biar gak keliatan fix)
------------------------------------------------------------
local function randomizeCoord(num)
	return num + math.random(1,5)/100
end

------------------------------------------------------------
-- âš™ï¸ State Khusus TAB RANDOM
------------------------------------------------------------
local autoRespawnRandomEnabled = false
local respawnRandomInterval = 3600 -- detik
local respawnRandomCount = 0
local countdownLabelRandom
local sliderDelayTaskRandom

-- counter rarity khusus tab random
local rarityCountsRandom = { Mythic = 0, Legendary = 0 }
local isRespawningRandom = false

-- flag untuk Mode Combo (biar notifnya gak spam)
local waitingComboNotifiedRandom = false


-- âœ… Inisialisasi Remote & Fungsi Toggle
local Autofish = GetNetRemote("RF/UpdateAutoFishingState")
local CurrentValueRandom = false

local function ToggleAutoFishing(state)
    pcall(function()
        Autofish:InvokeServer(state)
        CurrentValueRandom = state
        print("[AutoFishing Random]", state and "ON ğŸ£" or "OFF ğŸ’¤")
    end)
end

------------------------------------------------------------
-- ğŸ£ Fungsi RespawnNowRandom (Dua Kali Respawn + Teleport Random + Reset)
------------------------------------------------------------
local function RespawnNowRandom()
	if isRespawningRandom then return end
	isRespawningRandom = true

	task.spawn(function()
		------------------------------------------------------------
		-- â›” Matikan AutoFishing saat proses respawn mulai
		------------------------------------------------------------
		task.spawn(function()
			task.wait(2) -- kasih waktu dikit biar karakter kebentuk
			ToggleAutoFishing(false)
		end)

		local willResume = Config and Config.AutoFishing
		if StopAutoFish then StopAutoFish() end

		local hrp = safeGetHRP()
		if not hrp then
			Notify("âŒ Gagal Respawn (Random)", "HumanoidRootPart tidak ditemukan.", 3)
			isRespawningRandom = false
			return
		end

		local lastCFrame = hrp.CFrame
		local function doRespawnOnce(idx)
			local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
			if hum then hum.Health = 0 end
			local newChar = LocalPlayer.CharacterAdded:Wait()
			newChar:WaitForChild("HumanoidRootPart", 10)
			task.wait(1)
			Notify("â™»ï¸ Respawn (Random)", ("Respawn #%d selesai"):format(idx), 2)
		end

		-- Respawn #1
		doRespawnOnce(1)
		task.wait(0.3)

		-- ğŸ’° Jual ikan
		local sell = GetNetRemote and GetNetRemote("RF/SellAllItems")
		if sell then
			pcall(function()
				sell:InvokeServer()
				Notify("ğŸ’° Jual Ikan", "Semua ikan sudah dijual.", 2)
			end)
		end

		task.wait(1)
		doRespawnOnce(2)
		task.wait(0.4)

		------------------------------------------------------------
		-- ğŸš€ Teleport Random
		------------------------------------------------------------
		if #teleportList > 0 then
			local spot = teleportList[math.random(1, #teleportList)]
			local x = randomizeCoord(spot[1])
			local y = randomizeCoord(spot[2])
			local z = randomizeCoord(spot[3])
			local rot = spot[4] or 0

			local newChar = LocalPlayer.Character
			local newHRP = newChar and newChar:FindFirstChild("HumanoidRootPart")
			if newHRP then
				newHRP.CFrame = CFrame.new(x, y, z) * CFrame.Angles(0, math.rad(rot), 0)
				Notify("ğŸš€ Teleport Random", string.format("X=%.2f Y=%.2f Z=%.2f | %.1fÂ°", x, y, z, rot), 4)
			else
				Notify("âš ï¸ Gagal Teleport", "HRP tidak ditemukan setelah respawn.", 3)
			end
		else
			Notify("âš ï¸ Gagal Teleport", "Daftar teleport kosong.", 3)
		end

		------------------------------------------------------------
		-- ğŸ£ Equip rod kembali
		------------------------------------------------------------
		task.wait(0.5)
		local rs = game:GetService("ReplicatedStorage")
		local equipRodEvent = rs.Packages._Index["sleitnick_net@0.2.0"].net["RE/EquipToolFromHotbar"]
		if equipRodEvent then
			pcall(function()
				equipRodEvent:FireServer(1)
			end)
		end

		------------------------------------------------------------
        -- âœ… Cross-check sebelum nyalakan AutoFishing lagi
        ------------------------------------------------------------
		task.wait(0.5)
		local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
		if char and char:FindFirstChild("HumanoidRootPart") then
			if CurrentValueRandom == true then
				print("[AutoFishing Random] âš ï¸ Masih ON sebelum re-enable â€” resetting state...")
				ToggleAutoFishing(false)
				task.wait(0.3)
			end

			ToggleAutoFishing(true)
			Notify("ğŸ£ AutoFishing", "AutoFishing kembali diaktifkan.", 3)
		else
			print("[AutoFishing Random] âŒ Gagal nyalain ulang â€” karakter belum siap.")
			Notify("âš ï¸ AutoFishing", "Karakter belum siap untuk AutoFishing.", 3)
		end

		------------------------------------------------------------
		-- ğŸ’« Reset Counter Rare
		------------------------------------------------------------
		task.wait(0.2)
		rarityCountsRandom = { Mythic = 0, Legendary = 0 }
		sessionStartCaught = AllTimeCaught and AllTimeCaught.Value or 0

		------------------------------------------------------------
		-- ğŸ’« Reset Anti-Stuck
		------------------------------------------------------------
		if antiStuckEnabled then
			task.spawn(function()
				task.wait(1)
				fishSinceLastRare = 0
				lastCaughtForStuck = AllTimeCaught and AllTimeCaught.Value or 0
				print("[Anti-Stuck Reset Random] AllTimeCaught:", lastCaughtForStuck)
				if stuckProgressLabel then
					stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
				end
				Rayfield:Notify({
					Title = "ğŸ”„ Anti-Stuck Reset (Random)",
					Content = "Jumlah ikan tanpa rare direset setelah respawn random â™»ï¸",
					Duration = 3
				})
			end)
		end

		------------------------------------------------------------
		-- ğŸŸ  Balik orientasi ke arah terakhir
		------------------------------------------------------------
		local newHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if newHRP and lastCFrame then
			local x, y, z = lastCFrame:ToEulerAnglesYXZ()
			newHRP.CFrame = CFrame.new(newHRP.Position) * CFrame.Angles(x, y, z)
		end

		isRespawningRandom = false
	end)
end


------------------------------------------------------------
-- ğŸ§  Trigger Rarity (Versi RANDOM)
------------------------------------------------------------
-- default threshold sama seperti TabRespawn biasa
local legendThresholdRandom       = 7
local mythicThresholdRandom       = 2
local comboLegendNeededRandom     = 2
local comboMythicNeededRandom     = 1

local enableLegendaryModeRandom           = false
local enableMythicModeRandom              = false
local enableMythicBeforeLegendaryModeRandom = false
local enableComboModeRandom               = false

local rarityLabelRandom -- dideklarasi dulu, diisi setelah UI dibuat

local function HandleRarityTriggerRandom(counts, respawnFunc)
	if isRespawningRandom then return end

	local leg = counts.Legendary
	local myt = counts.Mythic

	-- Mode 1 â€“ Legendary
	if enableLegendaryModeRandom and leg >= legendThresholdRandom then
		Notify("ğŸŸ  Legendary Respawn (Random)", string.format("Mendapat %d Legendary â€“ respawn!", leg), 3)
		return respawnFunc()
	end

	-- Mode 2 â€“ Mythic
	if enableMythicModeRandom and myt >= mythicThresholdRandom then
		Notify("ğŸ”´ Mythic Respawn (Random)", string.format("Mendapat %d Mythic â€“ respawn!", myt), 3)
		return respawnFunc()
	end

	-- Mode 3 â€“ 2 Mythic sebelum Legendary penuh
	if enableMythicBeforeLegendaryModeRandom and myt >= 2 and leg < legendThresholdRandom then
		Notify("ğŸ‰ Trigger (Random)", "2 Mythic didapat sebelum Legendary penuh â€“ respawn ğŸ’€", 4)
		return respawnFunc()
	end

	-- Mode 4 â€“ Combo Smart (prioritas Mythic)
	if enableComboModeRandom then
		-- kalau Mythic > 1 sebelum L cukup â†’ respawn langsung
		if myt > 1 and leg < comboLegendNeededRandom then
			Notify("ğŸ”´ Mythic Priority (Random)",
				string.format("Mendapat %d Mythic sebelum %d Legendary â€“ respawn!", myt, comboLegendNeededRandom), 4)
			waitingComboNotifiedRandom = false
			return respawnFunc()
		end

		-- Legendary > comboLegendNeeded, belum ada Mythic â†’ tunggu Mythic
		if leg > comboLegendNeededRandom and myt == 0 then
			-- satu kali info (kalau mau, bisa di-uncomment)
			-- if not waitingComboNotifiedRandom then
			-- 	Notify("ğŸ£ Combo Waiting (Random)", string.format("%d Legendary, menunggu Mythic pertama...", leg), 3)
			-- 	waitingComboNotifiedRandom = true
			-- end
			return
		end

		-- jika sudah dapat Mythic setelah Legendary cukup
		if leg > comboLegendNeededRandom and myt >= 1 then
			Notify("âš¡ Combo Triggered (Random)",
				string.format("%d Legendary + %d Mythic â€“ respawn!", leg, myt), 4)
			waitingComboNotifiedRandom = false
			return respawnFunc()
		end

		-- kombinasi ideal pertama (misal 2L + 1M)
		if leg == comboLegendNeededRandom and myt == comboMythicNeededRandom then
			Notify("ğŸ’¥ Combo Aktif (Random)",
				string.format("%d Legendary + %d Mythic â€“ pantau Mythic berikutnya âš¡", leg, myt), 3)
			waitingComboNotifiedRandom = false
			return
		end
	end
end

------------------------------------------------------------
-- ğŸ”„ Listener Ikan (menggunakan UID â†’ rarity, versi RANDOM)
------------------------------------------------------------
local function connectFishListenerRandom()
	if REObtainedNewFishNotification then
		REObtainedNewFishNotification.OnClientEvent:Connect(function(_, _, fishData)
			if isRespawningRandom or not fishData or not fishData.ItemId then return end

			local rarity = getRarityFromUID(fishData.ItemId)
			if rarity == "Mythic" then
				rarityCountsRandom.Mythic += 1
			elseif rarity == "Legendary" then
				rarityCountsRandom.Legendary += 1
			end

			local totalRare = rarityCountsRandom.Mythic + rarityCountsRandom.Legendary
			if rarityLabelRandom then
				rarityLabelRandom:Set(string.format(
					"ğŸŸ  Legendary: %d | ğŸ”´ Mythic: %d | ğŸ£ Legendary + Mythic: %d",
					rarityCountsRandom.Legendary,
					rarityCountsRandom.Mythic,
					totalRare
				))
			end

			-- trigger rules khusus random
			HandleRarityTriggerRandom(rarityCountsRandom, RespawnNowRandom)
		end)
	else
		Notify("âš ï¸ Event Ikan (Random) Tidak Ditemukan", "Pastikan game masih sinkron dengan ReplicatedStorage", 5)
	end
end

connectFishListenerRandom()

------------------------------------------------------------
-- âš™ï¸ UI & MODE CONTROL SECTION (Sama seperti TabRespawn)
------------------------------------------------------------
TabRespawnRandom:CreateSection("ğŸ‰ Auto Respawn Random by Rarity UID")

------------------------------------------------------------
-- ğŸ·ï¸ Label Status Rarity
------------------------------------------------------------
rarityLabelRandom = TabRespawnRandom:CreateLabel(
	"ğŸŸ  Legendary: 0 | ğŸ”´ Mythic: 0 | ğŸ£ Legendary + Mythic: 0"
)

------------------------------------------------------------
-- ğŸŸ  Mode 1 â€“ Legendary (Random)
------------------------------------------------------------
TabRespawnRandom:CreateSlider({
	Name = "ğŸŸ  Batas Legendary untuk Respawn (Random)",
	Range = {1, 15},
	Increment = 1,
	CurrentValue = legendThresholdRandom,
	Callback = function(v)
		legendThresholdRandom = v
		Notify("ğŸŸ  Threshold Legendary (Random) Diubah",
			string.format("Respawn saat mendapat %d Legendary", v), 3)
	end
})

TabRespawnRandom:CreateToggle({
	Name = "ğŸŸ  Aktifkan Auto Respawn Legendary (Random)",
	CurrentValue = false,
	Callback = function(v)
		enableLegendaryModeRandom = v
		rarityCountsRandom = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸŸ  Mode Legendary Random Aktif",
				"Respawn random otomatis jika batas Legendary tercapai.", 4)
		else
			Notify("ğŸ§Š Mode Legendary Random Mati",
				"Berhenti pantau ikan Legendary (Random).", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ”´ Mode 2 â€“ Mythic (Random)
------------------------------------------------------------
TabRespawnRandom:CreateSlider({
	Name = "ğŸ”´ Batas Mythic untuk Respawn (Random)",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = mythicThresholdRandom,
	Callback = function(v)
		mythicThresholdRandom = v
		Notify("ğŸ”´ Threshold Mythic (Random) Diubah",
			string.format("Respawn saat mendapat %d Mythic", v), 3)
	end
})

TabRespawnRandom:CreateToggle({
	Name = "ğŸ”´ Aktifkan Auto Respawn Mythic (Random)",
	CurrentValue = false,
	Callback = function(v)
		enableMythicModeRandom = v
		rarityCountsRandom = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ”´ Mode Mythic Random Aktif",
				"Respawn random otomatis jika batas Mythic tercapai.", 4)
		else
			Notify("ğŸ§Š Mode Mythic Random Mati",
				"Berhenti pantau ikan Mythic (Random).", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ‰ Mode 3 â€“ 2 Mythic Before Legendary (Random)
------------------------------------------------------------
TabRespawnRandom:CreateToggle({
	Name = "ğŸ‰ Respawn jika dapat Mythic sebelum Legendary penuh (Random)",
	CurrentValue = false,
	Callback = function(v)
		enableMythicBeforeLegendaryModeRandom = v
		rarityCountsRandom = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ‰ Mode Random Aktif",
				"Respawn random jika 2 Mythic muncul lebih awal.", 4)
		else
			Notify("ğŸ§Š Mode Random Mati",
				"Berhenti pantau Mythic awal (Random).", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸ’¥ Mode 4 â€“ Combo (Legendary + Mythic Priority) RANDOM
------------------------------------------------------------
TabRespawnRandom:CreateSlider({
	Name = "ğŸŸ  Jumlah Legendary Combo (Random)",
	Range = {1, 10},
	Increment = 1,
	CurrentValue = comboLegendNeededRandom,
	Callback = function(v)
		comboLegendNeededRandom = v
		Notify("ğŸŸ  Combo Legendary Random Diubah",
			string.format("Dibutuhkan %d Legendary dalam combo (Random)", v), 3)
	end
})

TabRespawnRandom:CreateSlider({
	Name = "ğŸ”´ Jumlah Mythic Combo (Random)",
	Range = {1, 5},
	Increment = 1,
	CurrentValue = comboMythicNeededRandom,
	Callback = function(v)
		comboMythicNeededRandom = v
		Notify("ğŸ”´ Combo Mythic Random Diubah",
			string.format("Dibutuhkan %d Mythic dalam combo (Random)", v), 3)
	end
})

TabRespawnRandom:CreateToggle({
	Name = "ğŸ’¥ Mode Kombinasi (Legendary + Mythic Priority) Random",
	CurrentValue = false,
	Callback = function(v)
		enableComboModeRandom = v
		rarityCountsRandom = { Mythic = 0, Legendary = 0 }
		if v then
			Notify("ğŸ’¥ Mode Combo Random Aktif", string.format(
				"Respawn random setelah %d Legendary & %d Mythic (Mythic prioritas) âš¡",
				comboLegendNeededRandom, comboMythicNeededRandom
			), 4)
		else
			Notify("ğŸ§Š Mode Combo Random Mati",
				"Pantauan combo Random dinonaktifkan ğŸ’¤", 3)
		end
	end
})

------------------------------------------------------------
-- ğŸŸ Auto Respawn by Fish Count (Random)
------------------------------------------------------------
local fishBasedRespawnEnabledRandom = false
local lastCaughtRandom = 0
local caughtThresholdRandom = 1000 -- default tiap 1000 ikan

local fishProgressLabelRandom = TabRespawnRandom:CreateLabel(
	"ğŸŸ Next respawn after: 0 / " .. caughtThresholdRandom
)

task.spawn(function()
    while task.wait(1) do
        if not fishBasedRespawnEnabledRandom then
            fishProgressLabelRandom:Set("ğŸŸ Next respawn after: -- / --")
            continue
        end

        local now = AllTimeCaught.Value
        local diff = now - lastCaughtRandom
        local percent = math.min(100, math.floor((diff / caughtThresholdRandom) * 100))

        fishProgressLabelRandom:Set(string.format(
			"ğŸŸ Next respawn after: %d / %d (%d%%)",
			diff, caughtThresholdRandom, percent
		))
    end
end)

TabRespawnRandom:CreateToggle({
    Name = "ğŸŸ Auto Respawn by Fish Count (Random)",
    CurrentValue = false,
    Callback = function(Value)
        fishBasedRespawnEnabledRandom = Value
        if Value then
            lastCaughtRandom = AllTimeCaught.Value
            Rayfield:Notify({
                Title = "ğŸŸ Auto Respawn Random Aktif",
                Content = string.format("Respawn random otomatis tiap %d ikan ğŸ£", caughtThresholdRandom),
                Duration = 4
            })
        else
            Rayfield:Notify({
                Title = "âŒ Auto Respawn Random Mati",
                Content = "Respawn random berdasarkan ikan dimatikan ğŸ’‹",
                Duration = 3
            })
        end
    end
})

local sliderNotifyDelayRandom
TabRespawnRandom:CreateSlider({
    Name = "ğŸšï¸ Set Jumlah Ikan per Respawn (Random)",
    Range = {100, 5000},
    Increment = 100,
    CurrentValue = caughtThresholdRandom,
    Callback = function(Value)
        caughtThresholdRandom = math.floor(Value)

        if sliderNotifyDelayRandom then
            task.cancel(sliderNotifyDelayRandom)
        end

        sliderNotifyDelayRandom = task.delay(2, function()
            Rayfield:Notify({
                Title = "ğŸ£ Batas Ikan (Random) Diubah",
                Content = string.format("Respawn random setiap %d ikan tertangkap ğŸŸ", caughtThresholdRandom),
                Duration = 3
            })
        end)
    end
})

-- loop utama cek ikan (Random)
task.spawn(function()
    lastCaughtRandom = AllTimeCaught.Value
    while task.wait(5) do
        if not fishBasedRespawnEnabledRandom then continue end

        local nowCaught = AllTimeCaught.Value
        local diff = nowCaught - lastCaughtRandom

        if diff >= caughtThresholdRandom then
            Rayfield:Notify({
                Title = "â™»ï¸ Auto Respawn Random Triggered",
                Content = string.format("Menangkap %d ikan, respawn random dimulai ğŸŸ", diff),
                Duration = 4
            })
            RespawnNowRandom()
            lastCaughtRandom = nowCaught
        end
    end
end)


------------------------------------------------------------
-- ğŸ’« ANTI-STUCK SYSTEM (RESET DENGAN TOGGLE AUTO-REFRESH)
------------------------------------------------------------
local antiStuckEnabled = false
local noRareLimit = 300
local fishSinceLastRare = 0
local lastCaughtForStuck = AllTimeCaught.Value
local stuckProgressLabel = TabRespawnRandom:CreateLabel("ğŸ’« Ikan tanpa rare: -- / --")

-- Simpan referensi toggle biar bisa diubah dari script
local toggleAntiStuck

------------------------------------------------------------
-- ğŸ§© Fungsi Aktifkan/Matikan Anti-Stuck (biar bisa dipanggil internal)
------------------------------------------------------------
local function SetAntiStuckState(state)
	antiStuckEnabled = state
	if state then
		fishSinceLastRare = 0
		lastCaughtForStuck = AllTimeCaught.Value
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
	else
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: -- / --")
	end
end

------------------------------------------------------------
-- ğŸ§¿ TOGGLE UTAMA
------------------------------------------------------------
toggleAntiStuck = TabRespawnRandom:CreateToggle({
	Name = "ğŸ’« Aktifkan Anti-Stuck (No Rare Respawn)",
	CurrentValue = false,
	Callback = function(v)
		SetAntiStuckState(v)
		if v then
			Rayfield:Notify({
				Title = "ğŸ’« Anti-Stuck Aktif",
				Content = string.format("Respawn jika tidak ada rare dalam %d ikan ğŸŸ", noRareLimit),
				Duration = 4
			})
		else
			Rayfield:Notify({
				Title = "ğŸ§Š Anti-Stuck Dimatikan",
				Content = "Pantauan ikan tanpa rare dihentikan ğŸ’‹",
				Duration = 3
			})
		end
	end
})

------------------------------------------------------------
-- ğŸšï¸ SLIDER
------------------------------------------------------------
TabRespawnRandom:CreateSlider({
	Name = "ğŸŸ Batas Ikan Tanpa Rare Sebelum Respawn",
	Range = {100, 5000},
	Increment = 100,
	CurrentValue = noRareLimit,
	Callback = function(v)
		noRareLimit = math.floor(v)

		if antiStuckEnabled then
			stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
		end

		-- â³ Tambahkan delay 2 detik sebelum notifikasi muncul
		task.spawn(function()
			task.wait(2)
			Rayfield:Notify({
				Title = "ğŸŸ Batas Diubah",
				Content = "Respawn otomatis jika tidak ada rare dalam " .. noRareLimit .. " ikan.",
				Duration = 3
			})
		end)
	end
})

------------------------------------------------------------
-- ğŸ” LOOP ANTI-STUCK
------------------------------------------------------------
local function StartAntiStuckLoop()
	if _G.AntiStuckLoop then
		task.cancel(_G.AntiStuckLoop)
	end

	_G.AntiStuckLoop = task.spawn(function()
		while task.wait(1) do
			if not antiStuckEnabled then continue end

			local now = AllTimeCaught.Value
			local diff = now - lastCaughtForStuck

			if diff > 0 then
				fishSinceLastRare += diff
				lastCaughtForStuck = now

				local percent = math.min(100, math.floor((fishSinceLastRare / noRareLimit) * 100))
				stuckProgressLabel:Set(string.format("ğŸ’« Ikan tanpa rare: %d / %d (%d%%)", fishSinceLastRare, noRareLimit, percent))

				if fishSinceLastRare >= noRareLimit then
					if (rarityCounts.Legendary < legendThreshold) and (rarityCounts.Mythic < mythicThreshold) then
						Rayfield:Notify({
							Title = "ğŸ˜´ Tidak Ada Rare",
							Content = string.format("Sudah %d ikan tanpa Legendary/Mythic, respawn otomatis ğŸŒ€", noRareLimit),
							Duration = 4
						})

						RespawnNow()

						-- hentikan loop sementara agar gak konflik pas respawn
						task.wait(0.2)
						break
					else
						fishSinceLastRare = 0
						lastCaughtForStuck = AllTimeCaught.Value
						stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")
					end
				end
			end
		end
	end)
end

------------------------------------------------------------
-- ğŸ§  Listener: Mulai ulang loop setelah respawn
------------------------------------------------------------
player.CharacterAdded:Connect(function(newChar)
	if not antiStuckEnabled then return end

	task.spawn(function()
		newChar:WaitForChild("HumanoidRootPart", 10)
		task.wait(1)

		fishSinceLastRare = 0
		lastCaughtForStuck = AllTimeCaught.Value
		stuckProgressLabel:Set("ğŸ’« Ikan tanpa rare: 0 / " .. noRareLimit .. " (0%)")

		Rayfield:Notify({
			Title = "ğŸ”„ Anti-Stuck Reset",
			Content = "Counter direset & loop dimulai ulang setelah respawn â™»ï¸",
			Duration = 3
		})

		StartAntiStuckLoop()
	end)
end)

------------------------------------------------------------
-- ğŸ§© Jalankan loop pertama kali
------------------------------------------------------------
StartAntiStuckLoop()

------------------------------------------------------------
-- â±ï¸ Timer Countdown Loop (Random)
------------------------------------------------------------
local function startCountdownRandom()
	task.spawn(function()
		local remaining = respawnRandomInterval
		while autoRespawnRandomEnabled and remaining > 0 do
			countdownLabelRandom:Set("ğŸ• Next respawn (Random) in: " .. formatTime(remaining))
			task.wait(1)
			remaining -= 1
		end
		countdownLabelRandom:Set("ğŸ• Next respawn (Random) in: --")

		if autoRespawnRandomEnabled then
			RespawnNowRandom()
			task.wait(3)
			startCountdownRandom()
		end
	end)
end

------------------------------------------------------------
-- ğŸ•’ Label Countdown RANDOM
------------------------------------------------------------
countdownLabelRandom = TabRespawnRandom:CreateLabel("ğŸ• Next respawn (Random) in: --")

------------------------------------------------------------
-- ğŸ”˜ Toggle Auto Respawn RANDOM
------------------------------------------------------------
TabRespawnRandom:CreateToggle({
	Name = "â™»ï¸ Auto Respawn Loop (Random)",
	CurrentValue = false,
	Callback = function(Value)
		autoRespawnRandomEnabled = Value
		if Value then
			Rayfield:Notify({
				Title = "â™»ï¸ Auto Respawn Random Aktif",
				Content = string.format("Respawn random otomatis tiap %.0f menit ğŸ˜´", respawnRandomInterval / 60),
				Duration = 4
			})
			startCountdownRandom()
		else
			countdownLabelRandom:Set("ğŸ• Next respawn (Random) in: --")
			Rayfield:Notify({
				Title = "âŒ Auto Respawn Random Dimatikan",
				Content = "Respawn random otomatis dihentikan ğŸ’‹",
				Duration = 3
			})
		end
	end
})

------------------------------------------------------------
-- â±ï¸ Interval Respawn Slider (Random)
------------------------------------------------------------
TabRespawnRandom:CreateSlider({
	Name = "â±ï¸ Interval Respawn Random (menit)",
	Range = {1, 300},
	Increment = 1,
	CurrentValue = respawnRandomInterval / 60,
	Callback = function(Value)
		respawnRandomInterval = Value * 60

		if sliderDelayTaskRandom then
			task.cancel(sliderDelayTaskRandom)
		end

		sliderDelayTaskRandom = task.delay(2, function()
			Rayfield:Notify({
				Title = "â±ï¸ Interval Random Diperbarui",
				Content = string.format("Respawn random tiap %.0f menit (%s)", Value, formatTime(Value * 60)),
				Duration = 3
			})
			sliderDelayTaskRandom = nil
		end)
	end
})

------------------------------------------------------------
-- ğŸ”˜ Tombol Manual Respawn (Random)
------------------------------------------------------------
TabRespawnRandom:CreateButton({
	Name = "ğŸ”„ Respawn Sekarang (Random)",
	Callback = function()
		RespawnNowRandom()
	end
})


local function randomizeCoord(num)
	return num + math.random(1, 9) / 100
end

local function TeleportRandomOnly()
	local hrp = safeGetHRP()
	if not hrp then
		Notify("âš ï¸ Gagal Teleport", "Karakter belum siap, HRP tidak ditemukan.", 3)
		return
	end

	local spot = teleportList[math.random(1, #teleportList)]
	local x = randomizeCoord(spot[1])
	local y = randomizeCoord(spot[2])
	local z = randomizeCoord(spot[3])
	local rot = spot[4]

	pcall(function()
		hrp.CFrame = CFrame.new(x, y, z) * CFrame.Angles(0, math.rad(rot), 0)
	end)

	Notify("ğŸš€ Teleport Random", string.format("X=%.2f | Y=%.2f | Z=%.2f | %.1fÂ°", x, y, z, rot), 3)
end

------------------------------------------------------------
-- ğŸš€ Tombol Teleport Random (tanpa respawn)
------------------------------------------------------------
TabRespawnRandom:CreateButton({
	Name = "ğŸš€ Teleport Random (Acak Lokasi)",
	Callback = function()
		TeleportRandomOnly()
	end
})



------------------------------------------------------------
-- ğŸ§­ TAB 4: Tools & Utilities
------------------------------------------------------------
local TabTeleport = Window:CreateTab("ğŸ§­ Tools & Utilities")
local RunService = game:GetService("RunService")

------------------------------------------------------------
-- ğŸ§­ Fungsi Arah Kompas 16 Derajat (22.5Â° Interval)
------------------------------------------------------------
local function getCompass16(deg)
	local directions = {
		"N", "NNE", "NE", "ENE",
		"E", "ESE", "SE", "SSE",
		"S", "SSW", "SW", "WSW",
		"W", "WNW", "NW", "NNW"
	}
	local index = math.floor((deg + 11.25) / 22.5) % 16 + 1
	return directions[index]
end

------------------------------------------------------------
-- ğŸ“ Real-time Coordinates + Arah 16-Kompas ğŸŒ¸
------------------------------------------------------------
local coordsVisible = true
local coordsLabel = TabTeleport:CreateLabel("ğŸ“ Real-time Coordinates (Enabled)")

TabTeleport:CreateButton({
	Name = "ğŸ‘ï¸ Show / Hide Coordinates",
	Callback = function()
		coordsVisible = not coordsVisible
		if coordsVisible then
			coordsLabel:Set("ğŸ“ Real-time Coordinates (Enabled)")
			Rayfield:Notify({Title="Coordinates",Content="Real-time Coordinates ğŸ’š",Duration=2})
		else
			coordsLabel:Set("ğŸ“ Coordinates hidden âŒ")
			Rayfield:Notify({Title="Coordinates",Content="Coordinates hidden ğŸ‘ï¸â€ğŸ—¨ï¸",Duration=2})
		end
	end
})

TabTeleport:CreateButton({
	Name = "ğŸ“‹ Copy Coordinates",
	Callback = function()
		local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if root then
			local pos = root.Position
			setclipboard(string.format("%.2f, %.2f, %.2f", pos.X,pos.Y,pos.Z))
			Rayfield:Notify({
				Title = "Copied! ğŸ’¾",
				Content = string.format("Koordinat: X=%.2f | Y=%.2f | Z=%.2f", pos.X, pos.Y, pos.Z),
				Duration = 2
			})
		else
			Rayfield:Notify({
				Title = "Gagal ğŸ˜¢",
				Content = "Karakter belum terload ya, bubb ğŸ’‹",
				Duration = 2
			})
		end
	end
})

------------------------------------------------------------
-- ğŸ“‹ Copy Coordinates + Heading (tanpa arah & simbol Â°)
------------------------------------------------------------
TabTeleport:CreateButton({
	Name = "ğŸ§­ Copy Coordinates + Heading",
	Callback = function()
		local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if root then
			local pos = root.Position
			local lookVector = root.CFrame.LookVector
			local heading = math.deg(math.atan2(-lookVector.X, -lookVector.Z))
			if heading < 0 then heading = heading + 360 end

			-- Format: X, Y, Z <spasi> heading
			local result = string.format("%.2f, %.2f, %.2f %.1f", pos.X, pos.Y, pos.Z, heading)

			setclipboard(result)
			Rayfield:Notify({
				Title = "Copied! ğŸ’¾",
				Content = "Koordinat & Derajat disalin!\n" .. result,
				Duration = 2
			})
		else
			Rayfield:Notify({
				Title = "Gagal ğŸ˜¢",
				Content = "Karakter belum terload ya, bubb ğŸ’‹",
				Duration = 2
			})
		end
	end
})

--------------------------------------
-- ğŸ”„ Real-time Update: Koordinat
--------------------------------------
RunService.Heartbeat:Connect(function()
	if not coordsVisible then return end
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if root then
		local pos = root.Position
		local lookVector = root.CFrame.LookVector
		local heading = math.deg(math.atan2(-lookVector.X, -lookVector.Z))
		if heading < 0 then heading = heading + 360 end

		local arah16 = getCompass16(heading)
		coordsLabel:Set(string.format("ğŸ“ X: %.2f | Y: %.2f | Z: %.2f || %.1fÂ° %s", pos.X, pos.Y, pos.Z, heading, arah16))
	else
		coordsLabel:Set("ğŸ“ Waiting for character...")
	end
end)


------------------------------------------------------------
-- ğŸ’¾ Position Manager
------------------------------------------------------------
TabTeleport:CreateSection("ğŸ’¾ Position Manager")
getgenv().savedPos = getgenv().savedPos or nil

TabTeleport:CreateButton({
	Name = "ğŸ’¾ Save Current Position",
	Callback = function()
		local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if hrp then
			-- simpan CFrame (posisi + rotasi)
			getgenv().savedCFrame = hrp.CFrame
			local pos = hrp.Position
			Rayfield:Notify({
				Title = "Position Saved ğŸ’¾",
				Content = string.format("X: %.2f | Y: %.2f | Z: %.2f", pos.X, pos.Y, pos.Z),
				Duration = 3
			})
		end
	end
})

TabTeleport:CreateButton({
	Name = "âš¡ Teleport to Saved Position",
	Callback = function()
		local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if getgenv().savedCFrame and hrp then
			-- langsung set ke posisi & arah semula
			hrp.CFrame = getgenv().savedCFrame
			Rayfield:Notify({
				Title = "Teleport âš¡",
				Content = "Kembali ke posisi & arah tersimpan ğŸ˜",
				Duration = 2
			})
		else
			Rayfield:Notify({
				Title = "Belum ada posisi ğŸ˜¢",
				Content = "Tekan Save dulu ya sayang ğŸ’‹",
				Duration = 2
			})
		end
	end
})

LocalPlayer.CharacterAdded:Connect(function()
	if getgenv().savedCFrame then
		Rayfield:Notify({
			Title = "ğŸ’¾ Position Safe",
			Content = "Respawn detected, posisi & arah aman ğŸ˜˜",
			Duration = 3
		})
	end
end)

------------------------------------------------------------
-- ğŸ” SERVER TOOLS (DELTA PRIORITY MODE ğŸ’«)
------------------------------------------------------------
TabTeleport:CreateSection("ğŸ” Server Tools")

-- Services
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = game.Players.LocalPlayer
local HttpService = game:GetService("HttpService")

------------------------------------------------------------
-- ğŸ§  Fungsi Aman untuk Teleport (Hybrid Delta + Roblox)
------------------------------------------------------------
local function SafeTeleport(jobId, isPrivate)
	local success, err = pcall(function()
		--------------------------------------------------------
		-- ğŸ” 1ï¸âƒ£ Jika pakai Delta Executor
		--------------------------------------------------------
		if identifyexecutor and identifyexecutor():lower():find("delta") then
			local DeltaTP = getgenv().Delta or getgenv().delta
			if DeltaTP and typeof(DeltaTP) == "table" and DeltaTP.Teleport then
				Rayfield:Notify({
					Title = "ğŸŒ€ Delta Detected",
					Content = "Menggunakan teleport handler bawaan Delta ğŸ˜",
					Duration = 3
				})
				if isPrivate then
					DeltaTP.Teleport(game.PlaceId) -- Delta handle private dengan aman
				else
					DeltaTP.Teleport(game.PlaceId, jobId)
				end
				return
			end
		end

		--------------------------------------------------------
		-- ğŸ”’ 2ï¸âƒ£ Jika di Private Server & BUKAN Delta
		--------------------------------------------------------
		if isPrivate then
			local privateId = game.PrivateServerId
			local accessCode = game.PrivateServerAccessCode

			if privateId and privateId ~= "" then
				Rayfield:Notify({
					Title = "ğŸ”’ Private Server",
					Content = "Rejoining private server kamu sendiri ğŸ’«",
					Duration = 3
				})
				TeleportService:TeleportToPrivateServer(game.PlaceId, privateId, {LocalPlayer}, accessCode)
			else
				Rayfield:Notify({
					Title = "âš ï¸ Private ID / AccessCode Kosong",
					Content = "Tidak bisa rejoin private server tanpa AccessCode ğŸ˜¢",
					Duration = 4
				})
				error("PrivateServerId atau AccessCode tidak ditemukan.")
			end

		--------------------------------------------------------
		-- ğŸŒ 3ï¸âƒ£ Kalau di Public Server
		--------------------------------------------------------
		else
			Rayfield:Notify({
				Title = "ğŸŒ Public Server",
				Content = "Rejoining server publik yang sama ğŸ£",
				Duration = 3
			})
			TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, LocalPlayer)
		end
	end)

	--------------------------------------------------------
	-- âš ï¸ Error Handler
	--------------------------------------------------------
	if not success then
		warn("[Teleport Error]:", err)
		Rayfield:Notify({
			Title = "Teleport Gagal ğŸš«",
			Content = "Server mungkin penuh / restricted.\nError: " .. tostring(err),
			Duration = 5
		})
		pcall(function()
			local ui = game:GetService("CoreGui"):FindFirstChild("Rayfield")
			if ui then ui.Enabled = false; task.wait(0.4); ui.Enabled = true end
		end)
	end
end

------------------------------------------------------------
-- ğŸ’» AUTO REJOIN (Roblox PC Friendly)
------------------------------------------------------------
_G.JobID = nil
_G.AutoRetryTeleport = false

local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

------------------------------------------------------------
-- ğŸš€ Fungsi Auto Retry
------------------------------------------------------------
local function TryTeleport(jobId)
	task.spawn(function()
		while _G.AutoRetryTeleport and _G.JobID do
			pcall(function()
				Rayfield:Notify({
					Title = "ğŸ” Mencoba Joinâ€¦",
					Content = "Job ID: " .. jobId,
					Duration = 2
				})
				
				TeleportService:TeleportToPlaceInstance(
					game.PlaceId,
					jobId,
					LocalPlayer
				)
			end)

			-- Delay antar percobaan
			task.wait(3)
		end
	end)
end

------------------------------------------------------------
-- ğŸ”¤ Input Job ID
------------------------------------------------------------
TabTeleport:CreateInput({
	Name = "ğŸ”¤ Join via Job ID (Auto Retry PC)",
	PlaceholderText = "Masukkan Job ID (contoh: 3d62b1a9...)",
	RemoveTextAfterFocusLost = false,
	Callback = function(jobId)
		if not jobId or #jobId < 6 then
			Rayfield:Notify({
				Title = "Job ID Invalid âš ï¸",
				Content = "Masukkan minimal 6 karakter ya bubb ğŸ’‹",
				Duration = 3
			})
			return
		end
		
		_G.JobID = jobId

		Rayfield:Notify({
			Title = "ğŸ¯ Job ID Diset",
			Content = "Sekarang tinggal aktifin Auto Retry ya, bubb ğŸ˜",
			Duration = 3
		})
	end
})

------------------------------------------------------------
-- ğŸ”˜ Toggle Auto Retry On/Off
------------------------------------------------------------
TabTeleport:CreateToggle({
	Name = "ğŸ” Auto Retry Teleport",
	CurrentValue = false,
	Flag = "AutoRetryTeleport",
	Callback = function(state)
		_G.AutoRetryTeleport = state

		if state then
			if not _G.JobID then
				Rayfield:Notify({
					Title = "âš ï¸ Tidak Ada Job ID",
					Content = "Masukkan Job ID dulu ya bubb ğŸ˜",
					Duration = 3
				})
				_G.AutoRetryTeleport = false
				return
			end

			Rayfield:Notify({
				Title = "ğŸ” Auto Retry Aktif",
				Content = "Akan mencoba masuk terus ke Job ID: " .. _G.JobID,
				Duration = 4
			})

			TryTeleport(_G.JobID)

		else
			Rayfield:Notify({
				Title = "ğŸ›‘ Auto Retry Dimatikan",
				Content = "Berhenti mencoba join.",
				Duration = 3
			})
		end
	end
})



------------------------------------------------------------
-- ğŸ” SMART REJOIN BUTTON (PUBLIC / PRIVATE AUTO)
------------------------------------------------------------
TabTeleport:CreateButton({
	Name = "ğŸ” Rejoin Server (Smart Mode)",
	Callback = function()
		local isPrivate = (game.PrivateServerId and game.PrivateServerId ~= "")
		if isPrivate then
			Rayfield:Notify({
				Title = "ğŸ”’ Private Server Detected",
				Content = "Sedang mencoba rejoin private server...",
				Duration = 3
			})
			SafeTeleport(nil, true)
		else
			Rayfield:Notify({
				Title = "ğŸŒ Public Server Detected",
				Content = "Rejoining server publik yang sama ğŸ£",
				Duration = 3
			})
			SafeTeleport(game.JobId, false)
		end
	end
})

------------------------------------------------------------
-- â›” STOP SERVER HOP
------------------------------------------------------------
TabTeleport:CreateButton({
	Name = "â›” Stop Hopping",
	Callback = function()
		serverHopRunning = false
		Rayfield:Notify({
			Title = "Server Hop",
			Content = "Berhenti auto hop ğŸš«",
			Duration = 2
		})
	end
})

------------------------------------------------------------
-- ğŸŒ Tab Server Info
------------------------------------------------------------
local TabServer = Window:CreateTab("ğŸŒ Server Info")
TabServer:CreateSection("ğŸ“¡ Informasi Server Saat Ini")

-- Variabel untuk tombol copy agar tidak dobel
local copyJobButton = nil

-- Tombol utama untuk lihat info server
TabServer:CreateButton({
	Name = "ğŸ” Lihat Info Server Saat Ini",
	Callback = function()
		-- Ambil data server
		local jobId = game.JobId ~= "" and game.JobId or "N/A"
		local placeId = game.PlaceId
		local universeId = game.GameId
		local players = game.Players:GetPlayers()
		local playerCount = #players
		local maxPlayers = game.Players.MaxPlayers

		-- Gabung daftar nama pemain
		local playerNames = {}
		for _, p in ipairs(players) do
			table.insert(playerNames, string.format("â€¢ %s (@%s)", p.DisplayName, p.Name))
		end

		-- Format teks info
		local infoText = string.format(
			"ğŸ—ºï¸ **Game Info:**\nPlaceId: %s\nUniverseId: %s\n\nğŸ†” **Server:**\nJobId: %s\nğŸ‘¥ Pemain: %d/%d\n\nğŸ® **Daftar Pemain:**\n%s",
			tostring(placeId),
			tostring(universeId),
			tostring(jobId),
			playerCount,
			maxPlayers,
			table.concat(playerNames, "\n")
		)

		-- Tampilkan langsung info server di UI
		TabServer:CreateParagraph({
			Title = "ğŸŒ Server Info",
			Content = infoText
		})

		-- Notifikasi sukses
		Rayfield:Notify({
			Title = "âœ… Info Server Ditampilkan",
			Content = string.format("Berhasil menampilkan %d pemain di server ğŸ˜", playerCount),
			Duration = 3
		})

		-- Tambahkan tombol Copy Job ID (kalau belum ada)
		if not copyJobButton then
			copyJobButton = TabServer:CreateButton({
				Name = "ğŸ“‹ Copy Job ID",
				Callback = function()
					if jobId ~= "N/A" then
						setclipboard(jobId)
						Rayfield:Notify({
							Title = "ğŸ“‹ Copied!",
							Content = string.format("ğŸ’¾ Copy Job ID: %s", jobId),
							Duration = 3
						})
					else
						Rayfield:Notify({
							Title = "âš ï¸ Gagal Menyalin",
							Content = "Job ID tidak ditemukan (kemungkinan private server) ğŸ˜¢",
							Duration = 3
						})
					end
				end
			})
		end
	end
})

------------------------------------------------------------
-- ğŸ£ Tab Statistic
------------------------------------------------------------
-- local TabStatistic = Window:CreateTab("ğŸ£ Tas & Statistik")

-- local fishBagLabel = TabStatistic:CreateLabel("ğŸ“¦ Memuat data tas ikan...")
-- local totalCaughtLabel = TabStatistic:CreateLabel("ğŸŸ Total Caught: --")
-- local rareLabel = TabStatistic:CreateLabel("Rarest Fish: --")

-- TabStatistic:CreateButton({
--     Name = "ğŸ”„ Refresh Sekarang",
--     Callback = function()
--         SafeUpdateFishInfo()
--     end,
-- })

-- repeat task.wait() until game:IsLoaded()
-- local player = game.Players.LocalPlayer

-- local leaderstats = player:WaitForChild("leaderstats")
-- local AllTimeCaught = leaderstats:WaitForChild("Caught")
-- local RarestFish = leaderstats:WaitForChild("Rarest Fish")

-- ------------------------------------------------------------
-- -- ğŸ§© Ambil GUI Bag (safe)
-- ------------------------------------------------------------
-- local function GetFishBagGUI()
--     local bagLabel
--     pcall(function()
--         local gui = player:WaitForChild("PlayerGui", 2)
--         if gui then
--             bagLabel = gui:FindFirstChild("Backpack", true)
--                      and gui.Backpack.Display.Rods.BagSize
--         end
--     end)

--     if bagLabel and bagLabel.Text and bagLabel.Text:find("/") then
--         local cur, max = bagLabel.Text:match("(%d+)%s*/%s*([%d,%.%,]+)")
--         if cur and max then
--             cur = tonumber((cur:gsub("[^%d]", ""))) or 0
--             max = tonumber((max:gsub("[^%d]", ""))) or 4500
--             return cur, max
--         end
--     end

--     return nil, nil  -- supaya fungsi atas tahu GUI belum siap
-- end

-- ------------------------------------------------------------
-- -- ğŸ§  Update Fish Info (SAFE MODE)
-- ------------------------------------------------------------
-- function SafeUpdateFishInfo()
--     pcall(function()
--         local current, max = GetFishBagGUI()
--         if not current or not max then
--             fishBagLabel:Set("ğŸ£ Fish Bag: (GUI belum siap)")
--             return
--         end
        
--         local percent = math.floor((current / max) * 1000) / 10

--         fishBagLabel:Set(string.format("ğŸ£ Fish Bag: %d / %d (%.1f%% full)", current, max, percent))
--         totalCaughtLabel:Set(string.format("ğŸ  Total Caught: %d", AllTimeCaught.Value))
--         rareLabel:Set(string.format("Rarest Fish: %s", RarestFish.Value))
--     end)
-- end

-- ------------------------------------------------------------
-- -- ğŸ” Loop Aman (Anti 429)
-- ------------------------------------------------------------
-- task.spawn(function()
--     while task.wait(math.random(6, 10)) do
--         SafeUpdateFishInfo()
--     end
-- end)

-- -- first load
-- SafeUpdateFishInfo()


-- final ready notif
Notify("ğŸ£ SC FISH IT by @diketjup", "", 5)

-- End of script

-- 5
-- 3
-- 2
-- 1
-- 1000
-- 2000
-- 60


-- ngeluh capek/speak up nyari settingan? padahal udh disediain form diskusi tinggal scroll sesuaiin sm akun + rod lu
-- device tiap org beda beda TOLOL, ada yg pake pc/android/rf/ios bahkan segala mcm dengan latency yg beda juga pasti nya
-- mau dibikin disama ratakan semua dengan device developer biar dpt 5-6 notif sama kyk di anoncment? mikir lah mau narik angin kalau misal settingan ga cocok dan gabisa diatur sendiri sm kita sbg customer? mauu narik angin mau? 1 kali klik settingan default by developer?
-- malas atau iq lu yg kurang dan ga sampe?

-- lu ny aja yg alay ngeluh segala mcm capek nyari settingan, org lain pasti juga ada yg ngeluh kek lu tapi ga se alay ini



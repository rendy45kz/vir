-- AegisHub â€¢ Compact Glass UI (FIX: no AbsoluteSize at build-time)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

-- ===== THEME =====
local LOGO_ID = "rbxassetid://6031071053"
local NEON    = Color3.fromRGB(120, 90, 255)
local GLASS   = Color3.fromRGB(24, 26, 38)
local PANEL   = Color3.fromRGB(18, 20, 28)
local SCALE   = 0.78
local PW, PH  = 620, 360
local FONT    = Enum.Font.Gotham
local FBOLD   = Enum.Font.GothamSemibold

local function mount(g)
    if syn and syn.protect_gui then pcall(syn.protect_gui, g) end
    for _,p in ipairs({(gethui and gethui()) or nil, CoreGui, LocalPlayer:FindFirstChild("PlayerGui")}) do
        if p and p:IsDescendantOf(game) then
            if pcall(function() g.Parent = p end) then
                g.DisplayOrder = 1_000_000
                g.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                return
            end
        end
    end
end
local function mk(class, props, parent)
    local o = Instance.new(class); for k,v in pairs(props or {}) do o[k]=v end; o.Parent = parent; return o
end

-- blur
local Blur = Lighting:FindFirstChild("AegisHub_UIBlur") or mk("BlurEffect", {Name="AegisHub_UIBlur", Size=0}, Lighting)

-- roots
local SG = mk("ScreenGui", {Name="AegisHub_UI", ResetOnSpawn=false, IgnoreGuiInset=true}); mount(SG)
mk("UIScale", {Scale=SCALE}, SG)

-- overlay logo (draggable + neon)
local OSG = mk("ScreenGui", {Name="AegisHub_Overlay", ResetOnSpawn=false, IgnoreGuiInset=true}); mount(OSG)
local Overlay = mk("ImageButton", {
    Parent=OSG, Position=UDim2.new(0,12,0,12), Size=UDim2.fromOffset(52,52),
    Image=LOGO_ID, BackgroundColor3=PANEL, ZIndex=100
})
mk("UICorner", {CornerRadius=UDim.new(1,0)}, Overlay)
local ring = mk("ImageLabel", {
    Parent=Overlay, AnchorPoint=Vector2.new(0.5,0.5), Position=UDim2.new(0.5,0,0.5,0),
    BackgroundTransparency=1, Image="rbxassetid://5081164435", ImageColor3=NEON, ImageTransparency=0.25, Size=UDim2.fromOffset(70,70), ZIndex=100
})
do -- drag overlay
    local dragging, startPos, startUI
    Overlay.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging=true; startPos=i.Position; startUI=Overlay.Position
            i.Changed:Connect(function() if i.UserInputState==Enum.UserInputState.End then dragging=false end end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch) then
            local d = i.Position - startPos
            Overlay.Position = UDim2.new(startUI.X.Scale, startUI.X.Offset + d.X, startUI.Y.Scale, startUI.Y.Offset + d.Y)
        end
    end)
end

-- main panel
local Root = mk("Frame", {
    Parent=SG, Position=UDim2.new(0,80,0.08,0), Size=UDim2.fromOffset(PW, PH),
    BackgroundColor3=GLASS, BackgroundTransparency=0.14, ZIndex=50
})
mk("UICorner", {CornerRadius=UDim.new(0,14)}, Root)
mk("UIStroke", {Thickness=1, Color=NEON, Transparency=0.65}, Root)
mk("UIGradient", {
    Rotation=90,
    Transparency = NumberSequence.new{NumberSequenceKeypoint.new(0,0.90), NumberSequenceKeypoint.new(1,0.94)}
}, Root)

-- header (draggable)
local Header = mk("Frame", {Parent=Root, Size=UDim2.new(1,0,0,34), BackgroundTransparency=1, ZIndex=51})
mk("TextLabel", {
    Parent=Header, Position=UDim2.new(0,10,0,7), Size=UDim2.fromOffset(280,20), BackgroundTransparency=1,
    Text="AegisHub â€¢ Fish It", Font=FBOLD, TextSize=16, TextColor3=Color3.fromRGB(235,240,255),
    TextXAlignment=Enum.TextXAlignment.Left, ZIndex=51
})
do
    local dragging, sPos, sUI
    Header.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging=true; sPos=i.Position; sUI=Root.Position
            i.Changed:Connect(function() if i.UserInputState==Enum.UserInputState.End then dragging=false end end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch) then
            local d=i.Position - sPos
            Root.Position = UDim2.new(sUI.X.Scale, sUI.X.Offset + d.X, sUI.Y.Scale, sUI.Y.Offset + d.Y)
        end
    end)
end

-- layout
local Sidebar = mk("Frame", {
    Parent=Root, Position=UDim2.new(0,10,0,44), Size=UDim2.new(0,230,1,-56),
    BackgroundColor3=Color3.fromRGB(28,30,42), BackgroundTransparency=0.20, ZIndex=50
}); mk("UICorner", {CornerRadius=UDim.new(0,10)}, Sidebar)
local Content = mk("Frame", {
    Parent=Root, Position=UDim2.new(0,250,0,44), Size=UDim2.new(1,-260,1,-56),
    BackgroundColor3=Color3.fromRGB(28,30,42), BackgroundTransparency=0.20, ZIndex=50
}); mk("UICorner", {CornerRadius=UDim.new(0,10)}, Content)

-- search
local Search = mk("TextBox", {
    Parent=Sidebar, Position=UDim2.new(0,8,0,8), Size=UDim2.new(1,-16,0,28),
    BackgroundColor3=Color3.fromRGB(32,34,48), PlaceholderText="Search", Text="", Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50
}); mk("UICorner", {CornerRadius=UDim.new(0,8)}, Search)

-- menu
local Menu = mk("ScrollingFrame", {
    Parent=Sidebar, Position=UDim2.new(0,6,0,42), Size=UDim2.new(1,-12,1,-50),
    BackgroundTransparency=1, ScrollBarThickness=4, AutomaticCanvasSize=Enum.AutomaticSize.Y, ZIndex=50
})
mk("UIListLayout", {Parent=Menu, Padding=UDim.new(0,6), SortOrder=Enum.SortOrder.LayoutOrder})

local sections = {
    {id="farm",   title="Farming"},
    {id="inv",    title="Inventory"},
    {id="discord",title="Discord"},
    {id="about",  title="About"},
}
local selected, buttons = "farm", {}

local function menuBtn(item)
    local B = mk("TextButton", {
        Parent=Menu, Size=UDim2.new(1,-2,0,30), BackgroundColor3=Color3.fromRGB(32,34,48),
        Text=item.title, Font=FBOLD, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50
    })
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, B)
    local glow = mk("UIStroke", {Parent=B, Thickness=1, Color=NEON, Transparency=0.8})
    local function refresh()
        local active = (selected==item.id)
        B.BackgroundColor3 = active and Color3.fromRGB(38,40,58) or Color3.fromRGB(32,34,48)
        glow.Transparency = active and 0.4 or 0.8
    end
    B.MouseButton1Click:Connect(function()
        selected = item.id
        for _,t in pairs(buttons) do t() end
        for _,p in pairs(Content:GetChildren()) do if p:IsA("Frame") then p.Visible = (p.Name==selected) end end
    end)
    buttons[item.id] = refresh; refresh()
end
for _,it in ipairs(sections) do menuBtn(it) end

-- components
local function checkbox(parent, y, text, default, cb)
    local Row = mk("Frame", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,30), BackgroundTransparency=1, ZIndex=50})
    local Box = mk("TextButton", {Parent=Row, Position=UDim2.new(0,0,0,3), Size=UDim2.fromOffset(22,22), BackgroundColor3 = default and NEON or Color3.fromRGB(50,52,62), Text="", AutoButtonColor=false, ZIndex=50})
    mk("UICorner", {CornerRadius=UDim.new(0,6)}, Box)
    mk("UIStroke", {Parent=Box, Thickness=1, Color=NEON, Transparency=0.25})
    local Tick = mk("ImageLabel", {Parent=Box, BackgroundTransparency=1, Image="rbxassetid://3926305904", ImageRectOffset=Vector2.new(312,4), ImageRectSize=Vector2.new(24,24),
        Size=UDim2.fromScale(1,1), ImageColor3=Color3.new(1,1,1), ImageTransparency = default and 0 or 1, ZIndex=50})
    mk("TextLabel", {Parent=Row, Position=UDim2.new(0,30,0,0), Size=UDim2.new(1,-30,1,0), BackgroundTransparency=1, Text=text, Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Left, ZIndex=50})
    local state = default
    Box.MouseButton1Click:Connect(function()
        state = not state
        Tick.ImageTransparency = state and 0 or 1
        Box.BackgroundColor3 = state and NEON or Color3.fromRGB(50,52,62)
        pcall(cb, state)
    end)
    task.defer(function() pcall(cb, default) end)
end
local function field(parent, y, placeholder, cb)
    local F = mk("TextBox", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,30),
        BackgroundColor3=Color3.fromRGB(34,36,52), PlaceholderText=placeholder, Text="", Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, F)
    F.FocusLost:Connect(function(enter) if enter then pcall(cb, F.Text) end end)
end
local function button(parent, y, text, cb)
    local B = mk("TextButton", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,30),
        BackgroundColor3=Color3.fromRGB(38,40,58), Text=text, Font=FBOLD, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, B)
    mk("UIStroke", {Parent=B, Thickness=1, Color=NEON, Transparency=0.45})
    B.MouseButton1Click:Connect(function() pcall(cb) end)
end
local function dropdown(parent, y, label, options, onSelect)
    local Row = mk("Frame", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,30), BackgroundTransparency=1, ZIndex=50})
    mk("TextLabel", {Parent=Row, Position=UDim2.new(0,0,0,0), Size=UDim2.fromOffset(110,30), BackgroundTransparency=1, Text=label, Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(225,230,255), TextXAlignment=Enum.TextXAlignment.Left, ZIndex=50})
    local Box = mk("TextButton", {Parent=Row, Position=UDim2.new(0,118,0,0), Size=UDim2.new(1,-118,0,30),
        BackgroundColor3=Color3.fromRGB(34,36,52), Text="Selectâ€¦", Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, Box)
    local Open = false
    local ListFrame = mk("Frame", {Parent=Row, Position=UDim2.new(0,118,0,32), Size=UDim2.new(1,-118,0,0),
        BackgroundColor3=Color3.fromRGB(34,36,52), Visible=false, ClipsDescendants=true, ZIndex=60})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, ListFrame)
    local Scroll = mk("ScrollingFrame", {Parent=ListFrame, Size=UDim2.fromScale(1,1), BackgroundTransparency=1, ScrollBarThickness=4, AutomaticCanvasSize=Enum.AutomaticSize.Y, ZIndex=60})
    mk("UIListLayout", {Parent=Scroll, Padding=UDim.new(0,4), SortOrder=Enum.SortOrder.LayoutOrder})
    for _,opt in ipairs(options) do
        local It = mk("TextButton", {Parent=Scroll, Size=UDim2.new(1,-8,0,26), BackgroundColor3=Color3.fromRGB(40,42,58),
            Text=opt, Font=FONT, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), ZIndex=60})
        mk("UICorner", {CornerRadius=UDim.new(0,6)}, It)
        It.MouseButton1Click:Connect(function()
            Box.Text = opt; Open=false
            TweenService:Create(ListFrame, TweenInfo.new(0.15), {Size=UDim2.new(1,0,0,0)}):Play()
            task.delay(0.15, function() ListFrame.Visible=false end)
            pcall(onSelect, opt)
        end)
    end
    Box.MouseButton1Click:Connect(function()
        Open = not Open
        ListFrame.Visible = true
        TweenService:Create(ListFrame, TweenInfo.new(0.15), {Size=UDim2.new(1,0,0, Open and math.min(#options*30+6, 150) or 0)}):Play()
        if not Open then task.delay(0.15, function() ListFrame.Visible=false end) end
    end)
end

-- pages
local function page(id) return mk("Frame", {Parent=Content, Name=id, BackgroundTransparency=1, Size=UDim2.fromScale(1,1), Visible=(id=="farm"), ZIndex=50}) end

-- FARMING
local PFarm = page("farm")
checkbox(PFarm, 8, "Auto Fish", false, function(v)
    if v then if StartAutoFish then StartAutoFish() end else if StopAutoFish then StopAutoFish() end end
end)
checkbox(PFarm, 42, "Perfect Cast", true, function(v)
    if rawget(getfenv(),"state") then state.perfectCast = v end
end)
field(PFarm, 76,  "Speed x (1â€“5)", function(t) if rawget(getfenv(),"state") then state.SPEED = math.clamp(tonumber(t) or 5,1,5) end end)
field(PFarm, 110, "Override Reel Delay (ex: 1.45)", function(t) if rawget(getfenv(),"state") then state.reelOverride = tonumber(t) end end)
field(PFarm, 144, "Override Complete Delay (ex: 3.2)", function(t) if rawget(getfenv(),"state") then state.completeOverride = tonumber(t) end end)

-- INVENTORY
local PInv = page("inv")
checkbox(PInv, 8, "Auto Sell (>= threshold)", false, function(v)
    if rawget(getfenv(),"state") then state.AutoSell = state.AutoSell or {}; state.AutoSell.on = v end
end)
field(PInv, 42, "Threshold (default 60)", function(t)
    if rawget(getfenv(),"state") then state.AutoSell = state.AutoSell or {}; state.AutoSell.threshold = math.max(1, math.floor(tonumber(t) or 60)) end
end)
button(PInv, 78, "Protect High Tiers", function()
    if rawget(getfenv(),"state") then
        state.protectTiers = state.protectTiers or {}
        state.protectTiers.Legendary=true; state.protectTiers.Mythic=true; state.protectTiers.Secret=true
    end
    if protectByTiers then protectByTiers() end
end)
button(PInv, 114, "Sell Non-Favorite", function() if sellAllNonFav then sellAllNonFav() end end)

-- DISCORD
local PD = page("discord")
local Card = mk("Frame", {Parent=PD, Position=UDim2.new(0,10,0,10), Size=UDim2.new(1,-20,0,90), BackgroundColor3=Color3.fromRGB(32,34,48), ZIndex=50})
mk("UICorner", {CornerRadius=UDim.new(0,10)}, Card)
mk("TextLabel", {Parent=Card, Position=UDim2.new(0,10,0,10), Size=UDim2.new(1,-20,0,18), BackgroundTransparency=1, Text="Discord - AegisHub", Font=FBOLD, TextSize=14, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Left, ZIndex=50})
mk("TextLabel", {Parent=Card, Position=UDim2.new(0,10,0,34), Size=UDim2.new(1,-20,0,16), BackgroundTransparency=1, Text="Indonesia ðŸ‡®ðŸ‡©", Font=FONT, TextSize=13, TextColor3=Color3.fromRGB(205,210,230), TextXAlignment=Enum.TextXAlignment.Left, ZIndex=50})
local Copy = mk("TextButton", {Parent=Card, Position=UDim2.new(1,-160,0,28), Size=UDim2.fromOffset(150,28), BackgroundColor3=Color3.fromRGB(38,40,58), Text="ðŸ“‹ Copy Link", Font=FBOLD, TextSize=13, TextColor3=Color3.fromRGB(235,240,255), ZIndex=50})
mk("UICorner", {CornerRadius=UDim.new(0,8)}, Copy)
mk("UIStroke", {Parent=Copy, Thickness=1, Color=NEON, Transparency=0.45})
local DISCORD_LINK = "https://discord.gg/your-invite"
Copy.MouseButton1Click:Connect(function()
    pcall(function() if setclipboard then setclipboard(DISCORD_LINK) end end)
    Copy.Text = "âœ… Copied!"; task.delay(1, function() Copy.Text = "ðŸ“‹ Copy Link" end)
end)

-- ABOUT
local PAbout = page("about")
mk("TextLabel", {Parent=PAbout, Position=UDim2.new(0,10,0,10), Size=UDim2.new(1,-20,0,18), BackgroundTransparency=1,
    Text="AegisHub â€” Compact UI â€¢ Neon â€¢ Draggable â€¢ Checkboxes â€¢ Dropdown", Font=FONT, TextSize=13, TextColor3=Color3.fromRGB(230,235,255), TextXAlignment=Enum.TextXAlignment.Left, ZIndex=50})

-- contoh dropdown teleport (opsional)
local islands = rawget(getfenv(),"islandCoords") or { ["Kohana"]=Vector3.new(-658,3,719), ["Stingray Shores"]=Vector3.new(-32,4,2773), ["Coral Reefs"]=Vector3.new(-3095,1,2177), }
local names = {}; for n,_ in pairs(islands) do table.insert(names, n) end; table.sort(names)
local chosen = names[1]
dropdown(PFarm, 178, "Teleport", names, function(opt) chosen = opt end)
button(PFarm, 214, "Go Teleport", function()
    local pos = islands[chosen]; if not pos then return end
    local cf = workspace:FindFirstChild("Characters")
    local ch = cf and cf:FindFirstChild(LocalPlayer.Name)
    local hrp = ch and (ch:FindFirstChild("HumanoidRootPart") or ch:FindFirstChildWhichIsA("BasePart"))
    if hrp then hrp.CFrame = CFrame.new(pos + Vector3.new(0,5,0)) end
end)

-- default page state
for _,p in pairs(Content:GetChildren()) do if p:IsA("Frame") then p.Visible = (p.Name==selected) end end

-- show/hide toggle
local visible = true
local function setVisible(v)
    visible = v
    Root.Visible = v
    TweenService:Create(Blur, TweenInfo.new(0.16, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = v and 12 or 0}):Play()
    TweenService:Create(ring, TweenInfo.new(0.16), {ImageTransparency = v and 0.25 or 0.6}):Play()
end
Overlay.MouseButton1Click:Connect(function() setVisible(not visible) end)
setVisible(true)

-- AegisHub â€¢ Ultra-Compact Glass Sidebar UI (Delta Android friendly)
-- Ringkas, responsif, draggable, overlay toggle. Kompatibel dengan StartAutoFish/StopAutoFish/state/effDelays.

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local UIS = game:GetService("UserInputService")

-- ====== CONFIG MINI ======
local LOGO_ID = "rbxassetid://6031071053" -- ganti ke logo kamu
local ACCENT   = Color3.fromRGB(170,150,255)
local GLASS_BG = Color3.fromRGB(26,28,40)
local PANEL_BG = Color3.fromRGB(22,24,36)
local FONT     = Enum.Font.Gotham
local FBOLD    = Enum.Font.GothamSemibold
local SHOW_HUD = false   -- set ke true kalau ingin HUD kecil di pojok

-- ====== HELPERS ======
local function mount(gui)
    if syn and syn.protect_gui then pcall(syn.protect_gui, gui) end
    for _,p in ipairs({(gethui and gethui()) or nil, CoreGui, LocalPlayer:FindFirstChild("PlayerGui")}) do
        if p and p:IsDescendantOf(game) then
            if pcall(function() gui.Parent = p end) then
                gui.DisplayOrder = 1_000_000
                gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                return
            end
        end
    end
end
local function mk(class, props, parent)
    local o = Instance.new(class); for k,v in pairs(props or {}) do o[k]=v end; o.Parent = parent; return o
end

-- ====== RESPONSIVE SIZE ======
local vp = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize or Vector2.new(1280,720)
-- panel mengisi 68â€“72% lebar & 46â€“52% tinggi, pakai clamp agar tidak kebesaran di HP kecil
local PANEL_W = math.clamp(math.floor(vp.X * 0.72), 420, 560)
local PANEL_H = math.clamp(math.floor(vp.Y * 0.50), 280, 340)
-- skala global kecil
local SCALE = 0.66

-- ====== BLUR ======
local Blur = Lighting:FindFirstChild("AegisHub_UIBlur") or mk("BlurEffect", {Name="AegisHub_UIBlur", Size=0}, Lighting)

-- ====== ROOTS ======
local SG = mk("ScreenGui", {Name="AegisHub_MiniUI", ResetOnSpawn=false, IgnoreGuiInset=true}); mount(SG)
mk("UIScale", {Scale=SCALE}, SG)

-- ====== OVERLAY LOGO (DRAGGABLE) ======
local OverlaySG = mk("ScreenGui", {Name="AegisHub_Overlay", ResetOnSpawn=false, IgnoreGuiInset=true}); mount(OverlaySG)
local Overlay = mk("ImageButton", {
    Parent=OverlaySG, Position=UDim2.new(0,10,0,10), Size=UDim2.fromOffset(40,40),
    BackgroundColor3=PANEL_BG, Image=LOGO_ID, AutoButtonColor=true, ZIndex=100
})
mk("UICorner", {CornerRadius=UDim.new(1,0)}, Overlay)
mk("UIStroke", {Parent=Overlay, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})
local dragging, startPos, startUI
Overlay.InputBegan:Connect(function(i)
    if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
        dragging=true; startPos=i.Position; startUI=Overlay.Position
        i.Changed:Connect(function() if i.UserInputState==Enum.UserInputState.End then dragging=false end end)
    end
end)
UIS.InputChanged:Connect(function(i)
    if dragging and (i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch) then
        local d = i.Position - startPos
        local nx = math.clamp(startUI.X.Offset + d.X, 4, workspace.CurrentCamera.ViewportSize.X - 44)
        local ny = math.clamp(startUI.Y.Offset + d.Y, 4, workspace.CurrentCamera.ViewportSize.Y - 44)
        Overlay.Position = UDim2.new(0, nx, 0, ny)
    end
end)

-- ====== MAIN PANEL ======
local Root = mk("Frame", {
    Parent=SG, Position=UDim2.new(0, 12, 0.08, 0), Size=UDim2.fromOffset(PANEL_W, PANEL_H),
    BackgroundColor3=GLASS_BG, BackgroundTransparency=0.15
})
mk("UICorner", {CornerRadius=UDim.new(0,12)}, Root)
mk("UIStroke", {Thickness=1, Color=Color3.new(1,1,1), Transparency=0.82}, Root)
mk("UIGradient", {
    Rotation=90,
    Transparency = NumberSequence.new{
        NumberSequenceKeypoint.new(0, 0.88),
        NumberSequenceKeypoint.new(1, 0.92)
    }
}, Root)

-- Header (draggable)
local Header = mk("Frame", {Parent=Root, Size=UDim2.new(1,0,0,30), BackgroundTransparency=1})
mk("TextLabel", {
    Parent=Header, Position=UDim2.new(0,10,0,6), Size=UDim2.fromOffset(280,18), BackgroundTransparency=1,
    Text="AegisHub â€¢ Fish It", Font=FBOLD, TextSize=13, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Left
})
local dot = mk("Frame", {Parent=Header, AnchorPoint=Vector2.new(1,0), Position=UDim2.new(1,-10,0,10), Size=UDim2.fromOffset(6,6), BackgroundColor3=ACCENT})
mk("UICorner", {Parent=dot, CornerRadius=UDim.new(1,0)})

Header.InputBegan:Connect(function(i)
    if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
        dragging=true; startPos=i.Position; startUI=Root.Position
        i.Changed:Connect(function() if i.UserInputState==Enum.UserInputState.End then dragging=false end end)
    end
end)
UIS.InputChanged:Connect(function(i)
    if dragging and (i.UserInputType==Enum.UserInputType.MouseMovement or i.UserInputType==Enum.UserInputType.Touch) then
        local d = i.Position - startPos
        local nx = math.clamp(startUI.X.Offset + d.X, 0, math.max(0, workspace.CurrentCamera.ViewportSize.X - PANEL_W))
        local ny = math.clamp(startUI.Y.Offset + d.Y, 0, math.max(0, workspace.CurrentCamera.ViewportSize.Y - PANEL_H))
        Root.Position = UDim2.new(0, nx, 0, ny)
    end
end)

-- Layout: Sidebar + Content
local Sidebar = mk("Frame", {
    Parent=Root, Position=UDim2.new(0,10,0,40), Size=UDim2.new(0, math.floor(PANEL_W*0.42), 1, -50),
    BackgroundColor3=Color3.fromRGB(24,26,38), BackgroundTransparency=0.25
})
mk("UICorner", {CornerRadius=UDim.new(0,10)}, Sidebar)
mk("UIStroke", {Parent=Sidebar, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.88})

local Content = mk("Frame", {
    Parent=Root, Position=UDim2.new(0, math.floor(PANEL_W*0.42)+24, 0, 40), Size=UDim2.new(1, - (math.floor(PANEL_W*0.42)+34), 1, -50),
    BackgroundColor3=Color3.fromRGB(24,26,38), BackgroundTransparency=0.25
})
mk("UICorner", {CornerRadius=UDim.new(0,10)}, Content)
mk("UIStroke", {Parent=Content, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.88})

-- Sidebar: Search kecil
local Search = mk("TextBox", {
    Parent=Sidebar, Position=UDim2.new(0,8,0,6), Size=UDim2.new(1,-16,0,24),
    BackgroundColor3=Color3.fromRGB(30,32,46), PlaceholderText="Search", Text="", TextSize=12,
    Font=FONT, TextColor3=Color3.fromRGB(235,240,255), ClearTextOnFocus=false
})
mk("UICorner", {CornerRadius=UDim.new(0,8)}, Search)
mk("UIStroke", {Parent=Search, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})

-- Sidebar: menu list
local Menu = mk("ScrollingFrame", {
    Parent=Sidebar, Position=UDim2.new(0,6,0,34), Size=UDim2.new(1,-12,1,-42),
    BackgroundTransparency=1, ScrollBarThickness=4, AutomaticCanvasSize=Enum.AutomaticSize.Y
})
mk("UIListLayout", {Parent=Menu, Padding=UDim.new(0,5), SortOrder=Enum.SortOrder.LayoutOrder})

local sections = {
    {id="farm",   title="Farming"},
    {id="inv",    title="Inventory"},
    {id="info",   title="Information"},
    {id="discord",title="Discord"},
}
local selected, buttons = "farm", {}
local function menuBtn(data)
    local B = mk("TextButton", {
        Parent=Menu, Size=UDim2.new(1,-2,0,26), BackgroundColor3=Color3.fromRGB(30,32,46),
        Text=data.title, Font=FBOLD, TextSize=12, TextColor3=Color3.fromRGB(230,235,255)
    })
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, B)
    local st = mk("UIStroke", {Parent=B, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})
    local function refresh()
        local active = (selected==data.id)
        B.BackgroundColor3 = active and Color3.fromRGB(38,40,58) or Color3.fromRGB(30,32,46)
        st.Color, st.Transparency = (active and ACCENT or Color3.new(1,1,1)), (active and 0.45 or 0.85)
    end
    B.MouseButton1Click:Connect(function()
        selected = data.id
        for _,v in pairs(buttons) do v() end
        for _,p in pairs(Content:GetChildren()) do if p:IsA("Frame") then p.Visible = (p.Name==selected) end end
    end)
    buttons[data.id] = refresh; refresh()
end
for _,d in ipairs(sections) do menuBtn(d) end

-- ===== Components (mini) =====
local function page(id) return mk("Frame", {Parent=Content, Name=id, BackgroundTransparency=1, Size=UDim2.fromScale(1,1), Visible=(id==selected)}) end
local function label(parent, x, y, txt, bold)
    return mk("TextLabel", {Parent=parent, Position=UDim2.new(0,x,0,y), Size=UDim2.new(1,-x*2,0,18),
        BackgroundTransparency=1, Text=txt, Font=bold and FBOLD or FONT, TextSize=12, TextColor3=ACCENT, TextXAlignment=Enum.TextXAlignment.Left})
end
local function switch(parent, y, text, default, cb)
    local R = mk("Frame", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,26), BackgroundColor3=Color3.fromRGB(30,32,46)})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, R)
    mk("UIStroke", {Parent=R, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})
    mk("TextLabel", {Parent=R, BackgroundTransparency=1, Position=UDim2.new(0,8,0,0), Size=UDim2.new(1,-100,1,0),
        Text=text, Font=FONT, TextSize=12, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Left})
    local B = mk("TextButton", {Parent=R, AnchorPoint=Vector2.new(1,0.5), Position=UDim2.new(1,-6,0.5,0), Size=UDim2.fromOffset(74,22),
        BackgroundColor3 = default and Color3.fromRGB(46,160,67) or Color3.fromRGB(110,110,120),
        Text = default and "ON" or "OFF", Font=FBOLD, TextSize=11, TextColor3=Color3.new(1,1,1)})
    mk("UICorner", {CornerRadius=UDim.new(0,6)}, B)
    local st = default
    B.MouseButton1Click:Connect(function()
        st = not st
        B.Text = st and "ON" or "OFF"
        B.BackgroundColor3 = st and Color3.fromRGB(46,160,67) or Color3.fromRGB(110,110,120)
        pcall(cb, st)
    end)
    task.defer(function() pcall(cb, default) end)
end
local function field(parent, y, placeholder, cb)
    local F = mk("TextBox", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,26),
        BackgroundColor3=Color3.fromRGB(34,36,52), PlaceholderText=placeholder, Text="", Font=FONT, TextSize=12, TextColor3=Color3.fromRGB(235,240,255)})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, F)
    mk("UIStroke", {Parent=F, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})
    F.FocusLost:Connect(function(enter) if enter then pcall(cb, F.Text) end end)
end
local function button(parent, y, text, cb)
    local B = mk("TextButton", {Parent=parent, Position=UDim2.new(0,10,0,y), Size=UDim2.new(1,-20,0,26),
        BackgroundColor3=Color3.fromRGB(38,40,58), Text=text, Font=FBOLD, TextSize=12, TextColor3=Color3.fromRGB(235,240,255)})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, B)
    mk("UIStroke", {Parent=B, Thickness=1, Color=ACCENT, Transparency=0.45})
    B.MouseButton1Click:Connect(function() pcall(cb) end)
end

-- ===== Pages =====
local PFarm = page("farm")
label(PFarm, 10, 6, "Farming", true)
switch(PFarm, 26, "Auto Fish", false, function(v) if v then if StartAutoFish then StartAutoFish() end else if StopAutoFish then StopAutoFish() end end end)
switch(PFarm, 56, "Perfect Cast", true, function(v) if rawget(getfenv(),"state") then state.perfectCast = v end end)
field(PFarm,  86, "Speed x (1â€“5, default 5)", function(t) local n=tonumber(t) or 5; if rawget(getfenv(),"state") then state.SPEED = math.clamp(math.floor(n+0.5),1,5) end end)
field(PFarm, 116, "Override Reel Delay (opsional, ex: 1.45)", function(t) if rawget(getfenv(),"state") then state.reelOverride = tonumber(t) end end)
field(PFarm, 146, "Override Complete Delay (opsional, ex: 3.2)", function(t) if rawget(getfenv(),"state") then state.completeOverride = tonumber(t) end end)

local PInv = page("inv")
label(PInv, 10, 6, "Inventory", true)
button(PInv, 28, "Protect High Tiers", function()
    if rawget(getfenv(),"state") then
        state.protectTiers = state.protectTiers or {}
        state.protectTiers.Legendary=true; state.protectTiers.Mythic=true; state.protectTiers.Secret=true
    end
    if protectByTiers then protectByTiers() end
end)
button(PInv, 58, "Sell Non-Favorite", function() if sellAllNonFav then sellAllNonFav() end end)
switch(PInv, 88, "Auto Sell (>= threshold)", false, function(v) if rawget(getfenv(),"state") then state.AutoSell = state.AutoSell or {}; state.AutoSell.on=v end end)
field(PInv, 118, "Threshold (default 60)", function(t) if rawget(getfenv(),"state") then state.AutoSell = state.AutoSell or {}; state.AutoSell.threshold = math.max(1, math.floor(tonumber(t) or 60)) end end)

local PInfo = page("info")
label(PInfo, 10, 6, "Information", true)
mk("TextLabel", {Parent=PInfo, Position=UDim2.new(0,10,0,26), Size=UDim2.new(1,-20,0,36), BackgroundTransparency=1,
    Text="[+] Auto timing per-rod  [+] Speed x5  [+] Compact UI", Font=FONT, TextSize=12, TextColor3=Color3.fromRGB(230,235,255), TextXAlignment=Enum.TextXAlignment.Left, TextWrapped=true})

local PD = page("discord")
label(PD, 10, 6, "Discord", true)
local Card = mk("Frame", {Parent=PD, Position=UDim2.new(0,10,0,26), Size=UDim2.new(1,-20,0,86), BackgroundColor3=Color3.fromRGB(30,32,46)})
mk("UICorner", {CornerRadius=UDim.new(0,10)}, Card)
mk("UIStroke", {Parent=Card, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.82})
mk("ImageLabel", {Parent=Card, Position=UDim2.new(0,10,0,10), Size=UDim2.fromOffset(28,28), BackgroundTransparency=1, Image="rbxassetid://6034996695"})
mk("TextLabel", {Parent=Card, Position=UDim2.new(0,44,0,8), Size=UDim2.new(1,-54,0,18), BackgroundTransparency=1, Text="Discord - AegisHub", Font=FBOLD, TextSize=12, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Left})
mk("TextLabel", {Parent=Card, Position=UDim2.new(0,44,0,26), Size=UDim2.new(1,-54,0,16), BackgroundTransparency=1, Text="Indonesia ðŸ‡®ðŸ‡©", Font=FONT, TextSize=11, TextColor3=Color3.fromRGB(205,210,230), TextXAlignment=Enum.TextXAlignment.Left})
local Copy = mk("TextButton", {Parent=Card, Position=UDim2.new(0,10,0,54), Size=UDim2.new(1,-20,0,22), BackgroundColor3=Color3.fromRGB(38,40,58), Text="ðŸ“‹  Copy Link", Font=FBOLD, TextSize=11, TextColor3=Color3.fromRGB(235,240,255)})
mk("UICorner", {CornerRadius=UDim.new(0,6)}, Copy)
mk("UIStroke", {Parent=Copy, Thickness=1, Color=ACCENT, Transparency=0.45})
local DISCORD_LINK = "https://discord.gg/your-invite"
Copy.MouseButton1Click:Connect(function()
    pcall(function() if setclipboard then setclipboard(DISCORD_LINK) end end)
    Copy.Text="âœ… Copied!"; task.delay(1, function() Copy.Text="ðŸ“‹  Copy Link" end)
end)

-- ===== DEFAULT PAGE STATE =====
for _,p in pairs(Content:GetChildren()) do if p:IsA("Frame") then p.Visible = (p.Name==selected) end end

-- ===== SHOW/HIDE =====
local visible = true
local function setVisible(v)
    visible = v
    Root.Visible = v
    TweenService:Create(Blur, TweenInfo.new(0.16, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = v and 12 or 0}):Play()
end
Overlay.MouseButton1Click:Connect(function() setVisible(not visible) end)
setVisible(true)

-- ===== OPTIONAL HUD (kecil) =====
if SHOW_HUD then
    local HUD = mk("TextLabel", {Parent=SG, AnchorPoint=Vector2.new(1,1), Position=UDim2.new(1,-8,1,-8),
        Size=UDim2.fromOffset(280,22), BackgroundColor3=Color3.fromRGB(21,24,37), BackgroundTransparency=0.2,
        Font=FBOLD, TextSize=11, TextColor3=Color3.fromRGB(235,240,255), TextXAlignment=Enum.TextXAlignment.Right, Text="AegisHub â€¢ Ready"})
    mk("UICorner", {CornerRadius=UDim.new(0,8)}, HUD)
    mk("UIStroke", {Parent=HUD, Thickness=1, Color=Color3.new(1,1,1), Transparency=0.85})
    local function safeEff()
        local ef = rawget(getfenv(),"effDelays")
        if type(ef)=="function" then local c,r=ef(); return ("R:%.2fs C:%.2fs"):format(r or 0, c or 0) end
        return "R:- C:-"
    end
    game:GetService("RunService").RenderStepped:Connect(function()
        local rod="?"
        pcall(function()
            local pg=LocalPlayer:FindFirstChild("PlayerGui")
            local display=pg and pg:FindFirstChild("Backpack") and pg.Backpack:FindFirstChild("Display")
            if display then
                for _,tile in ipairs(display:GetChildren()) do
                    local ok,lbl=pcall(function() return tile.Inner and tile.Inner.Tags and tile.Inner.Tags.ItemName end)
                    if ok and lbl and lbl:IsA("TextLabel") then rod=lbl.Text break end
                end
            end
        end)
        local spd=(rawget(getfenv(),"state") and state.SPEED) or 5
        HUD.Text = ("Rod:%s | %s | x%d"):format(rod, safeEff(), spd)
    end)
end

-- AegisHub • Fish It • Orion UI (custom branding + logo)
-- Tempelkan DI BAWAH logika/fitur kamu yang sudah jalan (StartAutoFish, StopAutoFish, protectByTiers, sellAllNonFav, BoostFPS, setAntiAFK, dll).

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- ====== Loader Orion (guarded) ======
local OrionLib
do
    local ok, lib = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
    end)
    if ok and lib then OrionLib = lib else
        warn("[AegisHub] Gagal memuat OrionLib"); return
    end
end

-- ====== Window ======
local Window = OrionLib:MakeWindow({
    Name = "AegisHub • Fish It",
    HidePremium = true,
    SaveConfig = true,
    ConfigFolder = "AegisHub_FishIt",
    IntroEnabled = false
})

-- ====== Logo (optional) ======
local LOGO_ID = "rbxassetid://0" -- ganti dengan Decal ID kamu (contoh: rbxassetid://1234567890)
if LOGO_ID ~= "rbxassetid://0" then
    local SG = Instance.new("ScreenGui")
    SG.Name = "AegisHub_Logo"; SG.ResetOnSpawn = false; SG.IgnoreGuiInset = true
    local okParent = pcall(function() SG.Parent = (gethui and gethui()) or CoreGui end)
    if okParent then
        local Frame = Instance.new("Frame", SG)
        Frame.Size = UDim2.fromOffset(160, 50)
        Frame.Position = UDim2.new(0, 14, 0, 14)
        Frame.BackgroundTransparency = 1

        local Img = Instance.new("ImageLabel", Frame)
        Img.Size = UDim2.fromOffset(50, 50)
        Img.BackgroundTransparency = 1
        Img.Image = LOGO_ID

        local Title = Instance.new("TextLabel", Frame)
        Title.BackgroundTransparency = 1
        Title.Position = UDim2.new(0, 58, 0, 6)
        Title.Size = UDim2.fromOffset(460, 18)
        Title.Text = "AegisHub"
        Title.Font = Enum.Font.GothamBold
        Title.TextScaled = true
        Title.TextColor3 = Color3.fromRGB(230, 235, 255)

        local Sub = Instance.new("TextLabel", Frame)
        Sub.BackgroundTransparency = 1
        Sub.Position = UDim2.new(0, 58, 0, 26)
        Sub.Size = UDim2.fromOffset(460, 18)
        Sub.Text = "Fish It Automation"
        Sub.Font = Enum.Font.Gotham
        Sub.TextScaled = true
        Sub.TextColor3 = Color3.fromRGB(195, 205, 230)
    end
end

-- ====== Tabs ======
local tabMain   = Window:MakeTab({Name="Main", Icon="rbxassetid://4483345998", PremiumOnly=false})
local tabInv    = Window:MakeTab({Name="Inventory", Icon="rbxassetid://4483345998", PremiumOnly=false})
local tabTP     = Window:MakeTab({Name="Teleport", Icon="rbxassetid://4483345998", PremiumOnly=false})
local tabMisc   = Window:MakeTab({Name="Misc", Icon="rbxassetid://4483345998", PremiumOnly=false})

-- ====== Status label kecil di Main ======
local statusLabel = tabMain:AddParagraph("Status", "Rod: ?  |  Reel: -  |  Cmpl: -  |  Spd: 5x")

-- ====== Bridge ke variabel/fungsi yg sudah ada ======
-- Pastikan variabel berikut ada di skrip utamamu: state, effDelays, StartAutoFish, StopAutoFish, protectByTiers, sellAllNonFav, BoostFPS, setAntiAFK
-- Jika namanya beda, tinggal ubah callback di bawah.

-- Main
tabMain:AddToggle({
    Name = "Auto Fish",
    Default = false,
    Callback = function(v)
        if v then
            if StartAutoFish then StartAutoFish() end
        else
            if StopAutoFish then StopAutoFish() end
        end
    end
})

tabMain:AddToggle({
    Name = "Perfect Cast",
    Default = true,
    Callback = function(v)
        if state then state.perfectCast = v end
    end
})

tabMain:AddSlider({
    Name = "Speed x",
    Min = 1, Max = 5, Default = (state and state.SPEED) or 5,
    Color = Color3.fromRGB(120, 160, 255),
    Increment = 1,
    Callback = function(val)
        if state then state.SPEED = math.clamp(val, 1, 5) end
    end
})

tabMain:AddTextbox({
    Name = "Reel Delay (opt.)",
    Default = "",
    TextDisappear = false,
    Callback = function(txt)
        if state then state.reelOverride = tonumber(txt) end
    end
})

tabMain:AddTextbox({
    Name = "Complete Delay (opt.)",
    Default = "",
    TextDisappear = false,
    Callback = function(txt)
        if state then state.completeOverride = tonumber(txt) end
    end
})

-- Inventory
tabInv:AddToggle({
    Name = "Auto Sell",
    Default = false,
    Callback = function(v)
        if state then state.AutoSell.on = v end
    end
})

tabInv:AddTextbox({
    Name = "Threshold",
    Default = tostring((state and state.AutoSell and state.AutoSell.threshold) or 60),
    TextDisappear = false,
    Callback = function(txt)
        if state and state.AutoSell then
            local n = tonumber(txt)
            if n then state.AutoSell.threshold = math.max(1, math.floor(n)) end
        end
    end
})

tabInv:AddButton({
    Name = "Protect High Tiers",
    Callback = function()
        if state then
            state.protectTiers.Legendary = true
            state.protectTiers.Mythic    = true
            state.protectTiers.Secret    = true
        end
        if protectByTiers then protectByTiers() end
    end
})

tabInv:AddButton({
    Name = "Sell Non-Fav",
    Callback = function()
        if sellAllNonFav then sellAllNonFav() end
    end
})

-- Teleport (pakai tabel islandCoords milikmu kalau sudah ada)
local islandCoords = rawget(getfenv(), "islandCoords") or {}
local tpNames = {}
for n,_ in pairs(islandCoords) do table.insert(tpNames, n) end
table.sort(tpNames)
local chosen = tpNames[1]
tabTP:AddDropdown({
    Name = "Location",
    Default = chosen or "",
    Options = tpNames,
    Callback = function(opt) chosen = opt end
})
tabTP:AddButton({
    Name = "Go",
    Callback = function()
        local pos = islandCoords[chosen]
        local charFolder = workspace:FindFirstChild("Characters")
        local char = charFolder and charFolder:FindFirstChild(LocalPlayer.Name)
        local hrp = char and (char:FindFirstChild("HumanoidRootPart") or char:FindFirstChildWhichIsA("BasePart"))
        if hrp and pos then hrp.CFrame = CFrame.new(pos + Vector3.new(0,5,0)) end
    end
})

-- Misc
tabMisc:AddToggle({
    Name = "Anti-AFK",
    Default = true,
    Callback = function(v)
        if setAntiAFK then setAntiAFK(v) end
    end
})
tabMisc:AddToggle({
    Name = "FPS Boost",
    Default = false,
    Callback = function(v)
        if BoostFPS then BoostFPS(v) end
    end
})
tabMisc:AddButton({
    Name = "Rejoin",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
    end
})
tabMisc:AddButton({
    Name = "Server Hop",
    Callback = function()
        local HttpService = game:GetService("HttpService")
        local TeleportService = game:GetService("TeleportService")
        local servers, cursor = {}, ""
        for _=1,3 do
            local url = "https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"..(cursor~="" and("&cursor="..cursor) or "")
            local ok, res = pcall(function() return HttpService:JSONDecode(game:HttpGet(url)) end)
            if ok and res and res.data then
                for _,sv in ipairs(res.data) do
                    if sv.playing < sv.maxPlayers and sv.id ~= game.JobId then table.insert(servers, sv.id) end
                end
                cursor = res.nextPageCursor or ""
                if #servers > 0 then break end
            else break end
        end
        if #servers > 0 then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(1, #servers)], LocalPlayer)
        end
    end
})

-- ====== Live status updater (label) ======
spawn(function()
    while task.wait(0.2) do
        local rod = "?"
        pcall(function()
            local pg = LocalPlayer:FindFirstChild("PlayerGui")
            local display = pg and pg:FindFirstChild("Backpack") and pg.Backpack:FindFirstChild("Display")
            if display then
                for _,tile in ipairs(display:GetChildren()) do
                    local ok,lbl = pcall(function() return tile.Inner and tile.Inner.Tags and tile.Inner.Tags.ItemName end)
                    if ok and lbl and lbl:IsA("TextLabel") then rod = lbl.Text break end
                end
            end
        end)
        local cEff, rEff = 0, 0
        pcall(function()
            cEff, rEff = effDelays()
        end)
        if statusLabel and statusLabel.Set then
            statusLabel:Set(("Rod: %s  |  Reel: %.2fs  |  Cmpl: %.2fs  |  Spd: %dx"):format(rod, rEff or 0, cEff or 0, (state and state.SPEED) or 5))
        end
    end
end)

OrionLib:Init()

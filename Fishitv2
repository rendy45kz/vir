--========================================================
-- AEGISHUB UI LIBRARY - CLEAN BASE
--========================================================

if not game:IsLoaded() then game.Loaded:Wait() end

local Players            = game:GetService("Players")
local RunService         = game:GetService("RunService")
local Lighting           = game:GetService("Lighting")
local Workspace          = game:GetService("Workspace")
local UserInputService   = game:GetService("UserInputService")
local TweenService       = game:GetService("TweenService")
local CoreGui            = game:GetService("CoreGui")

local LocalPlayer        = Players.LocalPlayer
local UIS                = UserInputService

local ACCENT      = Color3.fromRGB(110,175,255)
local ACCENT_TEXT = Color3.fromRGB(227,229,255)
local BG_DARK     = Color3.fromRGB(42,44,56)
local BG_CARD     = Color3.fromRGB(30,31,41)

local function protect(inst)
    if syn and syn.protect_gui then syn.protect_gui(inst) end
end

local function tw(o,t,props)
    local a = TweenService:Create(o, TweenInfo.new(t, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
    a:Play()
    return a
end

----------------------------------------------------------------
-- UI LIBRARY
----------------------------------------------------------------
local library = {}

function library:CreateWindow(name, version, icon)
    name    = name    or "AegisHub"
    version = version or "Premium"
    icon    = icon    or 10044538000

    -- ScreenGui
    local Gui = Instance.new("ScreenGui")
    Gui.Name = "AegisHub_UI"
    Gui.ResetOnSpawn = false
    Gui.IgnoreGuiInset = false
    Gui.DisplayOrder = 9999
    Gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    protect(Gui)
    Gui.Parent = CoreGui

    -- Scale
    local function calcScale()
        local cam = Workspace.CurrentCamera
        local vp  = cam and cam.ViewportSize or Vector2.new(1280,720)
        local s   = math.min(vp.X, vp.Y)
        if s <= 720 then return .85 elseif s <= 900 then return .92 else return 1 end
    end
    local SCALE = calcScale()

    -- Overlay toggle (floating ball)
    local Overlay = Instance.new("ImageButton")
    Overlay.Parent = Gui
    Overlay.Size = UDim2.fromOffset(40,40)
    Overlay.BackgroundColor3 = Color3.fromRGB(32,34,46)
    Overlay.Image = "rbxassetid://10045753138"
    Overlay.ImageColor3 = ACCENT
    local u = Instance.new("UICorner",Overlay) u.CornerRadius = UDim.new(1,0)
    local s = Instance.new("UIStroke",Overlay) s.Transparency = .85

    -- Position overlay
    task.wait()
    local cam = Workspace.CurrentCamera
    Overlay.Position = UDim2.fromOffset(12, (cam.ViewportSize.Y/2)-20)

    -- Drag overlay
    do
        local dragging, startPos, startUIPos
        Overlay.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                startPos = i.Position
                startUIPos = Overlay.Position
                i.Changed:Connect(function()
                    if i.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)

        UIS.InputChanged:Connect(function(i)
            if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement) then
                local delta = i.Position - startPos
                local nx = startUIPos.X.Offset + delta.X
                local ny = startUIPos.Y.Offset + delta.Y
                Overlay.Position = UDim2.fromOffset(nx, ny)
            end
        end)
    end

    -- Window
    local Window = Instance.new("Frame")
    Window.Parent = Gui
    Window.Size = UDim2.fromOffset(520*SCALE, 340*SCALE)
    Window.Position = UDim2.new(.5, -260*SCALE, .5, -170*SCALE)
    Window.BackgroundColor3 = BG_DARK
    Instance.new("UICorner",Window).CornerRadius = UDim.new(0,6)

    -- Title bar
    local Title = Instance.new("Frame",Window)
    Title.Size = UDim2.new(1,0,0,30*SCALE)
    Title.BackgroundTransparency = 1

    local Icon = Instance.new("ImageLabel",Title)
    Icon.BackgroundTransparency = 1
    Icon.Size = UDim2.fromOffset(18*SCALE,18*SCALE)
    Icon.Position = UDim2.fromOffset(8,6)
    Icon.Image = "rbxassetid://"..icon
    Icon.ImageColor3 = ACCENT

    local TitleText = Instance.new("TextLabel",Title)
    TitleText.BackgroundTransparency = 1
    TitleText.Position = UDim2.fromOffset(30,0)
    TitleText.Size = UDim2.new(1,-30,1,0)
    TitleText.Font = Enum.Font.GothamMedium
    TitleText.TextSize = 12*SCALE
    TitleText.TextXAlignment = Enum.TextXAlignment.Left
    TitleText.Text = name.." - "..version
    TitleText.TextColor3 = Color3.new(1,1,1)

    local CloseBtn = Instance.new("TextButton",Title)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = "X"
    CloseBtn.TextColor3 = Color3.fromRGB(255,80,80)
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.TextSize = 14*SCALE
    CloseBtn.Size = UDim2.fromOffset(20,20)
    CloseBtn.Position = UDim2.new(1,-26,0,4)
    CloseBtn.MouseButton1Click:Connect(function() Gui:Destroy() end)

    -- Window Drag
    do
        local dragging, startPos, windowPos
        Title.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                startPos = i.Position
                windowPos = Window.Position
                i.Changed:Connect(function()
                    if i.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)
        UIS.InputChanged:Connect(function(i)
            if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                local d = i.Position - startPos
                Window.Position = UDim2.new(windowPos.X.Scale, windowPos.X.Offset+d.X, windowPos.Y.Scale, windowPos.Y.Offset+d.Y)
            end
        end)
    end

    -- Toggle show/hide window
    local hidden = false
    Overlay.MouseButton1Click:Connect(function()
        hidden = not hidden
        Window.Visible = not hidden
        tw(Overlay,.12,{ImageColor3 = hidden and Color3.fromRGB(200,200,200) or ACCENT})
    end)

    -- Tabs rail
    local TabsRail = Instance.new("Frame",Window)
    TabsRail.Position = UDim2.fromOffset(6,36*SCALE)
    TabsRail.Size = UDim2.fromOffset(136*SCALE, 340*SCALE - 42*SCALE)
    TabsRail.BackgroundColor3 = Color3.fromRGB(39,40,51)
    Instance.new("UICorner",TabsRail).CornerRadius = UDim.new(0,6)

    local TabsLayout = Instance.new("UIListLayout",TabsRail)
    TabsLayout.Padding = UDim.new(0,6)

    local label = Instance.new("TextLabel",TabsRail)
    label.BackgroundTransparency = 1
    label.Text = "Sections"
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.GothamBlack
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Position = UDim2.fromOffset(8,0)
    label.Size = UDim2.fromOffset(100,20)

    local firstTabLoaded = false

    --------------------------------------------------------
    -- MAKE PAGE FUNCTION
    --------------------------------------------------------
    local function makePage(title)
        local Page = Instance.new("ScrollingFrame",Window)
        Page.Visible = false
        Page.Position = UDim2.fromOffset(150*SCALE, 36*SCALE)
        Page.Size = UDim2.new(1,-156*SCALE,1,-42*SCALE)
        Page.CanvasSize = UDim2.new(0,0,0,0)
        Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
        Page.ScrollBarThickness = 4
        Page.ScrollBarImageColor3 = ACCENT
        Page.BackgroundColor3 = BG_DARK
        Instance.new("UICorner",Page).CornerRadius = UDim.new(0,6)

        local pad = Instance.new("UIPadding",Page)
        pad.PaddingTop = UDim.new(0,6)
        pad.PaddingLeft = UDim.new(0,6)
        pad.PaddingRight = UDim.new(0,6)
        pad.PaddingBottom = UDim.new(0,6)

        local vlist = Instance.new("UIListLayout",Page)
        vlist.Padding = UDim.new(0,6)

        local TabBtn = Instance.new("TextButton",TabsRail)
        TabBtn.Text = title
        TabBtn.BackgroundTransparency = 1
        TabBtn.TextColor3 = Color3.new(1,1,1)
        TabBtn.TextTransparency = .5
        TabBtn.Font = Enum.Font.Gotham
        TabBtn.TextSize = 11*SCALE
        TabBtn.Size = UDim2.fromOffset(130*SCALE,20)

        local indicator = Instance.new("Frame",TabBtn)
        indicator.Size = UDim2.fromOffset(2, 16)
        indicator.Position = UDim2.fromOffset(-6,2)
        indicator.BackgroundColor3 = ACCENT
        indicator.Visible = false

        local function select()
            -- hide all pages
            for _,v in ipairs(Window:GetChildren()) do
                if v:IsA("ScrollingFrame") then v.Visible = false end
            end
            -- reset all tabs
            for _,b in ipairs(TabsRail:GetChildren()) do
                if b:IsA("TextButton") then
                    b.TextTransparency = .5
                    local ind = b:FindFirstChildWhichIsA("Frame")
                    if ind then ind.Visible = false end
                end
            end
            -- activate this
            indicator.Visible = true
            TabBtn.TextTransparency = 0
            Page.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(select)
        if not firstTabLoaded then firstTabLoaded = true; select() end

        ----------------------------------------------------
        -- PAGE API (label, toggle, box, dropdown)
        ----------------------------------------------------
        local PageAPI = {}

        function PageAPI:CreateLabel(text)
            local L = Instance.new("TextLabel",Page)
            L.BackgroundTransparency = 1
            L.Font = Enum.Font.GothamBlack
            L.TextSize = 12*SCALE
            L.TextColor3 = Color3.new(1,1,1)
            L.TextXAlignment = Enum.TextXAlignment.Left
            L.Size = UDim2.new(1,0,0,16)
            L.Text = string.upper(text)
            return L
        end

        function PageAPI:CreateButton(text, callback)
            callback = callback or function() end
            local B = Instance.new("TextButton",Page)
            B.Size = UDim2.new(1,0,0,30)
            B.BackgroundColor3 = BG_CARD
            B.Font = Enum.Font.GothamSemibold
            B.TextSize = 11*SCALE
            B.TextColor3 = Color3.new(1,1,1)
            B.Text = text
            Instance.new("UICorner",B).CornerRadius = UDim.new(0,6)
            B.MouseButton1Click:Connect(callback)
            return B
        end

        function PageAPI:CreateBox(placeholder, callback)
            callback = callback or function() end

            local container = Instance.new("Frame",Page)
            container.BackgroundColor3 = BG_CARD
            container.Size = UDim2.new(1,0,0,50)
            Instance.new("UICorner",container).CornerRadius = UDim.new(0,6)

            local txt = Instance.new("TextLabel",container)
            txt.BackgroundTransparency = 1
            txt.Position = UDim2.fromOffset(8,4)
            txt.Size = UDim2.new(1,-16,0,16)
            txt.Font = Enum.Font.GothamBlack
            txt.TextSize = 12*SCALE
            txt.TextColor3 = Color3.new(1,1,1)
            txt.TextXAlignment = Enum.TextXAlignment.Left
            txt.Text = placeholder

            local box = Instance.new("TextBox",container)
            box.Position = UDim2.fromOffset(8,22)
            box.Size = UDim2.new(1,-16,0,22)
            box.BackgroundColor3 = Color3.fromRGB(24,25,32)
            box.Font = Enum.Font.Gotham
            box.TextColor3 = Color3.new(1,1,1)
            box.PlaceholderText = placeholder
            box.TextSize = 11*SCALE
            Instance.new("UICorner",box).CornerRadius = UDim.new(0,6)

            box.FocusLost:Connect(function()
                callback(box.Text)
            end)

            return box
        end

        function PageAPI:CreateToggle(text, callback)
            callback = callback or function() end

            local container = Instance.new("Frame",Page)
            container.Size = UDim2.new(1,0,0,30)
            container.BackgroundColor3 = BG_CARD
            Instance.new("UICorner",container).CornerRadius = UDim.new(0,6)

            local lbl = Instance.new("TextLabel",container)
            lbl.BackgroundTransparency = 1
            lbl.Font = Enum.Font.Gotham
            lbl.TextSize = 11*SCALE
            lbl.TextColor3 = Color3.new(1,1,1)
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Position = UDim2.fromOffset(8,6)
            lbl.Size = UDim2.new(1,-50,1,-12)
            lbl.Text = text

            local btn = Instance.new("TextButton",container)
            btn.Size = UDim2.fromOffset(36,18)
            btn.Position = UDim2.new(1,-44,0.5,-9)
            btn.BackgroundColor3 = Color3.fromRGB(24,25,32)
            btn.Text = ""
            Instance.new("UICorner",btn).CornerRadius = UDim.new(1,0)

            local dot = Instance.new("Frame",btn)
            dot.Size = UDim2.fromOffset(16,16)
            dot.Position = UDim2.fromOffset(2,1)
            dot.BackgroundColor3 = ACCENT
            dot.BackgroundTransparency = .5
            Instance.new("UICorner",dot).CornerRadius = UDim.new(1,0)

            local state = false

            local function update()
                if state then
                    tw(dot,.12,{
                        Position = UDim2.fromOffset(18,1),
                        BackgroundTransparency = 0
                    })
                else
                    tw(dot,.12,{
                        Position = UDim2.fromOffset(2,1),
                        BackgroundTransparency = .5
                    })
                end
                callback(state)
            end

            btn.MouseButton1Click:Connect(function()
                state = not state
                update()
            end)

            return {
                Set = function(_,v)
                    state = v
                    update()
                end
            }
        end

        function PageAPI:CreateDropdown(title, options, callback)
            callback = callback or function() end
            options = options or {}

            local container = Instance.new("Frame",Page)
            container.Size = UDim2.new(1,0,0,60)
            container.BackgroundColor3 = BG_CARD
            Instance.new("UICorner",container).CornerRadius = UDim.new(0,6)

            local lbl = Instance.new("TextLabel",container)
            lbl.Text = title
            lbl.Font = Enum.Font.GothamBlack
            lbl.TextSize = 12*SCALE
            lbl.TextColor3 = Color3.new(1,1,1)
            lbl.BackgroundTransparency = 1
            lbl.Position = UDim2.fromOffset(8,4)
            lbl.Size = UDim2.new(1,-16,0,16)
            lbl.TextXAlignment = Enum.TextXAlignment.Left

            local mainBtn = Instance.new("TextButton",container)
            mainBtn.Position = UDim2.fromOffset(8,24)
            mainBtn.Size = UDim2.new(1,-16,0,24)
            mainBtn.BackgroundColor3 = Color3.fromRGB(24,25,32)
            mainBtn.TextColor3 = Color3.new(1,1,1)
            mainBtn.Font = Enum.Font.Gotham
            mainBtn.Text = "Select"
            mainBtn.TextSize = 11*SCALE
            Instance.new("UICorner",mainBtn).CornerRadius = UDim.new(0,6)

            local listHolder = Instance.new("Frame",container)
            listHolder.Visible = false
            listHolder.BackgroundColor3 = BG_CARD
            listHolder.Position = UDim2.fromOffset(8,52)
            listHolder.Size = UDim2.new(1,-16,0,0)
            listHolder.AutomaticSize = Enum.AutomaticSize.Y
            Instance.new("UICorner",listHolder).CornerRadius = UDim.new(0,6)

            local layout = Instance.new("UIListLayout",listHolder)
            layout.Padding = UDim.new(0,4)

            local currentValue = nil

            local function rebuild()
                for _,v in ipairs(listHolder:GetChildren()) do
                    if v:IsA("TextButton") then v:Destroy() end
                end

                for _,opt in ipairs(options) do
                    local op = Instance.new("TextButton",listHolder)
                    op.Size = UDim2.new(1,0,0,22)
                    op.BackgroundColor3 = Color3.fromRGB(24,25,32)
                    op.Font = Enum.Font.Gotham
                    op.TextSize = 11*SCALE
                    op.TextColor3 = Color3.new(1,1,1)
                    op.Text = opt
                    Instance.new("UICorner",op).CornerRadius = UDim.new(0,6)

                    op.MouseButton1Click:Connect(function()
                        currentValue = opt
                        mainBtn.Text = opt
                        listHolder.Visible = false
                        callback(opt)
                    end)
                end
            end

            rebuild()

            mainBtn.MouseButton1Click:Connect(function()
                listHolder.Visible = not listHolder.Visible
            end)

            return {
                SetValue = function(_,v)
                    currentValue = v
                    mainBtn.Text = tostring(v)
                end,
                SetOptions = function(_,opts)
                    options = opts
                    rebuild()
                end,
                GetValue = function() return currentValue end
            }
        end

        return PageAPI
    end

    --------------------------------------------------------
    -- RETURN WINDOW API
    --------------------------------------------------------
    local winAPI = {}

    function winAPI:CreateTab(title)
        local tabObj = {}
        function tabObj:CreateFrame(pageTitle)
            return makePage(pageTitle or title)
        end
        return tabObj
    end

    return winAPI
end

--========================================================
-- Buat window utama
--========================================================
local win = library:CreateWindow("AegisHub - Fish It", "Premium")
